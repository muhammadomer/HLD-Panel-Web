@model Hld.WebApplication.ViewModel.PredictionPOViewModel;

<style>
    .table-bordered thead th, .table-bordered thead td {
        padding: 0px;
        border-bottom-width: 2px;
    }

    .table thead th {
        vertical-align: middle !important;
        text-align: center;
        border-bottom: 2px solid #dee2e6;
    }
    

    .table th, .table td {
        padding: 0.40rem;
        vertical-align: top;
        border-top: 1px solid #dee2e6;
        vertical-align: middle !important;
    }

    .table td {
        text-align: center;
    }

    .table tbody tr:hover td {
        background: #f1f1f1;
        cursor: pointer;
    }

    .table {
        border-left: #ccc 1px solid !important;
        border-right: #ccc 1px solid !important;
        border-bottom: #ccc 1px solid !important;
    }

    .colorhead {
        color: #548b8d;
    }

    .myclass {
        position: fixed;
        top: 17%;
        left: 90%;
        color: green;
        transform: translate(-50%, -50%);
        box-sizing: border-box;
        padding: 30px;
    }

    .loader {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 9999;
        opacity: .9;
        background-color: rgb(249,249,249);
    }

        .loader img {
            top: 50%;
            position: absolute;
            left: 50%;
            margin: 0;
            margin-right: -50%;
            transform: translate(-50%,-50%);
        }

    .hidedialogbox {
        font-family: Arial;
        position: absolute;
        top: 1000px;
        width: 1000px;
        height: auto;
    }
    .warning1 {
        border-color: red;
    }
    .mydlete {
        position: fixed;
        top: 17%;
        left: 90%;
        color: red;
        transform: translate(-50%, -50%);
        box-sizing: border-box;
        padding: 30px;
    }

    .tooltipQtyShowCoverdays {
        position: relative;
        display: contents;
        cursor: pointer !important;
    }

        .tooltipQtyShowCoverdays .tooltiptextShowdays {
            visibility: hidden;
            width: 279px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            font-family: arial;
            position: absolute;
            z-index: 401;
            margin-top: -33px;
            margin-left: -178px;
            opacity: 0;
            transition: opacity 0.3s;
        }

            .tooltipQtyShowCoverdays .tooltiptextShowdays::after {
                content: "";
                position: absolute;
                top: 101%;
                left: 51%;
                transform: rotate(0deg);
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: #555 transparent transparent transparent;
            }

        .tooltipQtyShowCoverdays:hover .tooltiptextShowdays {
            visibility: visible;
            opacity: 1;
        }
    .tooltipQtyShowRes {
        position: relative;
        display: contents;
        cursor: pointer !important;
    }

        .tooltipQtyShowRes .tooltiptextShowRes {
            visibility: hidden;
            width: 250px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            font-family: arial;
            position: absolute;
            z-index: 401;
            margin-left: -146px;
            top: 167px;
            opacity: 0;
            transition: opacity 0.3s;
        }

            .tooltipQtyShowRes .tooltiptextShowRes::after {
                content: "";
                position: absolute;
                top: 101%;
                left: 51%;
                transform: rotate(0deg);
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: #555 transparent transparent transparent;
            }

    .tooltipQtyShowRes:hover .tooltiptextShowRes {
        visibility: visible;
        opacity: 1;
    }
    .tooltipQtyShow {
        position: relative;
        display: contents;
        cursor: pointer!important;
    }
        .tooltipQtyShow .tooltiptextShow {
            visibility: hidden;
            width: 244px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            font-family: arial;
            position: absolute;
            z-index: 401;
            margin-top: -33px;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
        }
            .tooltipQtyShow .tooltiptextShow::after {
                content: "";
                position: absolute;
                top: 101%;
                left: 51%;
                transform: rotate(0deg);
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: #555 transparent transparent transparent;
            }
        .tooltipQtyShow:hover .tooltiptextShow {
            visibility: visible;
            opacity: 1;
        }

    .tooltipQtyShow {
        position: relative;
        display: contents;
        cursor: pointer !important;
    }

    .tooltipQtyShowApp .tooltiptextShowApp {
        visibility: hidden;
        
        width: 103px;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px 0;
        font-family: arial;
        position: absolute;
        z-index: 401;
        margin-top: -33px;
        margin-left: -80px;
        opacity: 0;
        transition: opacity 0.3s;
    }

        .tooltipQtyShowApp .tooltiptextShowApp::after {
            content: "";
            position: absolute;
            top: 101%;
            left: 51%;
            transform: rotate(0deg);
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }

    .tooltipQtyShowApp:hover .tooltiptextShowApp {
        visibility: visible;
        opacity: 1;
    }

    .tooltipqtysold {
        display: inline-block;
        position: relative;
        text-align: left;
        cursor: not-allowed;
    }

        .tooltipqtysold .topdata {
            min-width: 250px;
            height: auto;
            max-width: 700px;
            top: -5px;
            max-height: 400px;
            left: 0%;
            transform: translate(-30%,-100%);
            padding: 4px 20px;
            color: black;
            background-color: white;
            font-weight: normal;
            font-size: 14px;
            border: 1px solid gray;
            border-radius: 8px;
            position: absolute;
            z-index: 99999999;
            box-sizing: border-box;
            box-shadow: 0 1px 8px rgba(0,0,0,0.5);
            display: none;
        }

            .tooltipqtysold .topdata::after {
                content: "";
                position: absolute;
                top: 100%;
                left: 34%;
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: #615A5A transparent transparent transparent;
            }
    .tooltipphyqty {
        display: inline-block;
        position: relative;
        text-align: left;
        cursor: not-allowed;
    }

        .tooltipphyqty .topdata {
            min-width: 300px;
            height: 100px;
            max-width: 700px;
            top: -5px;
            left: 0%;
            transform: translate(-30%,-100%);
            padding: 4px 20px;
            color: black;
            background-color: white;
            font-weight: normal;
            font-size: 14px;
            border: 1px solid gray;
            border-radius: 8px;
            position: absolute;
            z-index: 99999999;
            box-sizing: border-box;
            box-shadow: 0 1px 8px rgba(0,0,0,0.5);
            display: none;
            height: auto;
        }

            .tooltipphyqty .topdata::after {
                content: "";
                position: absolute;
                top: 100%;
                left: 34%;
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: #615A5A transparent transparent transparent;
            }
</style>

<div class="container-fluid mt-3">

    <div class="loader">
        <img src="~/Images/giffff.gif" />
    </div>
    <div class="card mb-3 mt-3">
        <div style="padding:0px" class="card-header">
            <b style="vertical-align: sub; margin-left: 13px;">New PO Draft</b>
            <div style="float: right;">
                @if (Model.POstatus == 6 || Model.POstatus == 0)
                {
                    <button class="btn btn-danger btn-style deletePO">Delete</button>
                }
            </div>

        </div>
        <div class="row ml-0 mt-1 mb-1">
            <div class="col-2">
                <label class="control-label mb-0 colorhead"><b>HLD PO ID:</b> </label>
                <label class="control-label mb-0 ">&nbsp;@Model.InternalPOID</label><br />
                <label class="control-label mb-0 colorhead"><b>Date:</b></label>
                <label class="control-label mb-0 ">
                    &nbsp;@if (Model.OrderedOn != DateTime.MinValue)
                    {
                        @string.Format("{0: MMM d, yyyy}", Model.OrderedOn)
                    }
                </label>
            </div>
            <div class="col-2">
                <label class="control-label mb-0 colorhead"><b>SKU's:</b></label>
                <label class="control-label mb-0 ">@Model.list.Count()</label><br />
                <label class="control-label mb-0 colorhead"><b>Total PO Qty:</b></label>
                <label class="control-label mb-0 ">@Model.list.Sum(s => s.POQty)</label><br />
            </div>
            <div class="col-2">

                <label class="control-label mb-0 colorhead"><b>Vendor:</b></label>
                <label class="control-label mb-0 ">@Model.Vendor</label><br />
                <label class="control-label mb-0 colorhead"><b>Currency:</b></label>
                <label class="control-label mb-0 ">@Model.Currency</label>
            </div>
            <div class="col-2">

                @{
                    decimal Mastercurency = @Model.list.Sum(s => s.ApprovedUnitPrice*s.POQty);
                    decimal USDCurrency = 0;

                    if (@Model.Currency == "CNY")
                    {
                        USDCurrency = Mastercurency / Convert.ToDecimal(7.07);

                    }
                    if (Model.Currency == "CAD")
                    {
                        USDCurrency = Mastercurency / Convert.ToDecimal(1.40);
                    }
                    if (Model.Currency == "USD")
                    {
                        USDCurrency = Mastercurency;
                    }
                }
                <label class="control-label mb-0 colorhead"><b>@Model.Currency:</b></label>
                <label class="control-label mb-0 ">&nbsp;@string.Format("{0:N2}", Mastercurency) </label><br />
                <label class="control-label mb-0 colorhead"><b>USD:</b></label>
                <label class="control-label mb-0 ">&nbsp;@string.Format("{0:N2}", @USDCurrency) </label><br />
            </div>
            <div class=" col-4">

                <label class="col-4 control-label colorhead"><b>PO Description:</b></label>
                <div class="col-12">
                    @*<input type="text" multiple="true"  class="form-control Notes" id="Notes" name="Notes" value="@Model.Notes" />*@
                    <textarea class="form-control Notes" id="Notes" name="Notes" value="@Model.Notes">@Model.Notes</textarea>
                </div>
            </div>
        </div>



    </div>

    <div class="container-fluid p-0">
        <table class="table mytabledroft tablesorter">
            <thead style="background-color:lightgray!important;">
                <tr>
                    <th style="width:0.1%"><input type="checkbox" class="checkboxes " id="headerCheckBox" /></th>
                    <th>
                        Image

                    </th>
                    <th style="width:11%">
                        SKU

                    </th>
                    <th style="width:7%">
                        Phy Qty

                    </th>
                    <th style="width:8%">
                        <span class="tooltipQtyShowRes" style="cursor:pointer!important">
                            Resvd  Qty
                            <span class="tooltiptextShowRes">  Reserved Qty for Orders & FBA Shipment</span>

                        </span>
                    </th>
                    <th style="width:7%">
                        On Order

                    </th>
                    <th>
                        Sold60

                    </th>

                    <th>
                        <span class="tooltipQtyShow" style="cursor:pointer!important">
                            Cover_T
                            <span class="tooltiptextShow"> Includes Phy Qty + OnOrder + Reserved</span>
                        </span>

                    </th>
                    <th style="width:8%">
                        Cover Phy

                    </th>

                    <th>
                        Velocity

                    </th>
                    <th>
                        D_60
                    </th>
                    <th>
                        D_90

                    </th>

                    <th style="width:10%">
                        CP PO QTY
                    </th>
                    <th>
                        CasePack
                    </th>







                    <th style="width:9%">
                        <span class="tooltipQtyShowApp" style="cursor:pointer!important">
                            Appr Price
                            <span class="tooltiptextShowApp">Approved Price</span>
                        </span>


                    </th>
                    <th>
                        Amount
                    </th>
                    <th style="width:9%">
                        <span class="tooltipQtyShowCoverdays" style="cursor:pointer!important">
                            Cover Days
                            <span class="tooltiptextShowdays"> Includes Phy Qty + OnOrder + Reserved + PO</span>
                        </span>


                    </th>
                    <th style="width:7%">
                        Cover Date

                    </th>




                    <th style="width: 10%;">
                        Qty to Order

                    </th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.list)
                {
                <tr>
                    @*@{
                        var vendorValue = item.m[0].VendorAlias != "" ? "0" : "1";

                    }*@
                    <td> <input type="checkbox" class="checkboxes " id="checkbox" /></td>
                    <td>
                        <a target="_blank" href="@ViewBag.S3BucketURL_large/@item.LargImage">
                            <img src="@ViewBag.S3BucketURL/@item.SmallImage" class="rounded" height="50" width="50" />
                        </a>
                    </td>
                    <td>
                        <input type='text' style="display:none" class='form-control Id' value='@item.idPurchaseOrdersItems'>
                        <input type='text' style="display:none" class='form-control OnOrder' value='@item.OnOrder'>
                        <input type='text' style="display:none" class='form-control SKU' value='@item.SKU'>
                        <input type='text' style="display:none" class='form-control PhysicalQty' value='@item.PhysicalQty'>
                        <input type='text' style="display:none" class='form-control ReservdQty' value='@item.ReservedQty'>
                        <input type="text" class="form-control Velocity" value="@item.Velocity" style="display:none" />
                        <input type='text' style="display:none" class='form-control ApprovedUnitPrice SKU' value='@item.ApprovedUnitPrice'>
                        <a href="/BestBuyProduct/PropertyPage?ProductSKU=@item.SKU" class="skuspan" target="_blank">@item.SKU</a>  <br />
                        <div class="">
                            <a style="cursor:pointer" href="https://lp.cwa.sellercloud.com/Inventory/Product_Dashboard.aspx?Id=@item.SKU" target="_blank">
                                <img height="15px" width="20px" src="~/Images/sellercloud-gray.png" />
                            </a>

                            <a style='margin-left:5px; cursor: pointer;' href='/ApprovedPrice/Index?&sku=@item.SKU' target='_blank'>
                                <img src='~/Images/ok-1.1s-128px.png' class='rounded' height='25'>
                            </a>

                            <a style="cursor:pointer" href="/PurchaseOrder/GetPOProduct?VendorID=&SKU=@item.SKU&EmptyFirstTime=No&POID=&title=&ItemType=OpenItem&orderDateTimeFrom=&orderDateTimeTo=" title="Product in PO's" target="_blank">
                                <img src="~/Images/right-1.png" height='20' />
                            </a>
                        </div>
                       
                    </td>
                    <td class="PhysicalQty">
                        
                                        <span class="tooltipphyqty">
                                            <span class="phyqty" style="cursor:pointer;color:#007bff;font-size:12px;">@item.PhysicalQty</span>
                                            <span class="topdata phyqtyspan">

                                            </span>
                                            </span>
                                    </td>
                    <td class="ReservdQty">@item.ReservedQty</td>
                    <td>@item.OnOrder</td>
                    <td>
                        <div class="tooltipqtysold">
                            <div class="qtySoldSpan" style="cursor:pointer;color:#007bff;font-size:12px;">@item.QtySold60</div>
                            <div class="topdata QtySold row">

                            </div>
                        </div>
                        @*@item.QtySold60*@

                    </td>



                    <td class="reve">
                       
                        @item.CoverDays
                       
                    </td>
                    <td class="">
                       
                        @item.CoverPhy
                        
                    </td>
                    <td>
                        @Math.Round(@item.Velocity, 2)

                    </td>
                    <td>
                        @item.POQty
                    </td>
                    <td>@Math.Round(@item.LowStock90, 0)</td>

                    <td>
                        @{

                            decimal CP = 0;
                            decimal CP2 = 0;
                            decimal dfdcp = 0;
                            string dfdcp2 = "0";
                            if (item.CasePackQty > 0)
                            {
                                dfdcp = Convert.ToDecimal(@item.POQty) / Convert.ToDecimal(@item.CasePackQty);
                                CP = Math.Round(dfdcp, 2) * @item.CasePackQty;
                                CP2 = Math.Round(dfdcp) * @item.CasePackQty;
                                dfdcp2 = Math.Round(dfdcp) + ".00";
                            }

                        }
                        @if (item.CasePackQty > 0)
                        {
                            <span>@Math.Round(dfdcp, 2) *@item.CasePackQty = @Math.Round(CP)</span><br />
                            <span style="color:forestgreen">@dfdcp2 *@item.CasePackQty = @Math.Round(CP2)</span><br />
                        }
                    </td>

                    <td>
                        <input type='text' style="display:none" class='form-control CasePackQty' value='@item.CasePackQty'>
                        @if (@item.CasePackQty > 0)
                        {

                            <a href="/ShipmentCasePack/GetTemplateList?SKU=@item.SKU" target="_blank" style="cursor:pointer">@item.CasePackQty</a>
                        }
                        else
                        {
                            <a style='cursor: pointer;' href='/ShipmentCasePack/SaveTemplate?SKU=@item.SKU&Vendor=Yes' target='_blank'>
                                <span style="color:gray">CP</span>
                            </a>
                        }
                        @*@item.CasePackQty*@


                    </td>




                    <td>
                        @Model.Currency @item.ApprovedUnitPrice
                    </td>

                    <td class="amount">
                        @{
                            var amount = (Convert.ToDecimal(item.POQty)*(@item.ApprovedUnitPrice));
                        }
                       @Math.Round(amount,2)
                    </td>

                    @{
                        
                    }
                    <td class="coverdays">
                       @{
                           //var coverday = @item.Velocity!=0?Convert.ToInt32(Convert.ToInt32(Convert.ToDecimal(item.PhysicalQty) + Convert.ToDecimal(item.OnOrder) + Convert.ToDecimal(item.ReservedQty)+ Convert.ToDecimal(item.POQty))/ Convert.ToDecimal(@item.Velocity)):0;
                           //var date = DateTime.Now.AddDays(item.CoverDays);
                           var coverday = @item.Velocity != 0 ? Convert.ToInt32(Convert.ToInt32(Convert.ToDecimal(item.PhysicalQty) + Convert.ToDecimal(item.OnOrder) + Convert.ToDecimal(item.ReservedQty) + Convert.ToDecimal(item.POQty)) / Convert.ToDecimal(@item.Velocity)) : 0;
                           var date = DateTime.Now.AddDays(coverday);
                       } 
                        @coverday
                    </td>
                    <td class="date">@string.Format("{0: MMM d, yyyy}", @date)</td>


                    <td>
                        <input type="text" class="form-control POQty" value="@item.POQty" />
                    </td>

                    <td>
                        @if (Model.POstatus == 6 || Model.POstatus == 0)
                        {
                            <button type='button' class='btn btn-sm delete' data-id="@item.idPurchaseOrdersItems" style='' value=''><img src="~/Images/trash-can-1.1s-128px.png" height="25" /></button>
                        }
                    </td>

                </tr>
                }
            </tbody>
        </table>
        <div style="">
            @if (Model.POstatus == 6 || Model.POstatus == 0)
            {
                <div style="float:left">
                    <button class=" btn btn-primary btn-style " id="btnAddItem" value="" style="box-shadow:none"> Add Item</button>
                </div>
                <div style="float: right;">

                    <button class=" btn btn-primary btn-style " id="btnSave" value="" style="box-shadow:none"> Save</button>
                    <button class=" btn btn-success btn-style " id="btnPost" value="" style="box-shadow:none"> Post to SC</button>

                </div>
            }
        </div>


    </div>
    <div class="modal fade" id="myModalPostSC" style="margin-top: 130px;">
        <div class="modal-dialog modal-md">
            <div class="modal-content modelwidth">

                <!-- Modal Header -->
                <div class="modal-header">

                    <strong>
                        <i class="fa fa-check" style=" color: green;
font-size: 20px;vertical-align:bottom!important"></i><span style="vertical-align: text-top;margin-left: 4px;
">Successfull!</span>
                    </strong>


                    <button type="button" class="close closeModel" data-dismiss="modal">&times;</button>
                </div>


                <div class="modal-body myclassPostSC" style="padding-left:0!important;">



                </div>


                <div class="modal-footer">
                    <button type="button" class="btn btn-default closeModel" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>
</div>
<div class="hidedialogbox ">
    <div id="dialog-box">
        <h6 style="color:red">Do you want to delete this reocord!</h6>
    </div>
</div>


@section Scripts{
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="~/sticky-table-headers/js/jquery.stickytableheaders.min.js"></script>
    <script src="~/lib/jQuery-Paging/jquery.paging.min.js"></script>
    <script src="~/lib/jQuery-MultiSelect/jquery.multiselect.js"></script>
    <script src="~/select2/js/select2.full.min.js"></script>

    <script src="~/lib/date-range-picker/moment.min.js"></script>
    <script src="~/lib/date-range-picker/daterangepicker.js"></script>

    <script src="~/lib/jquery.tablesorter/js/jquery.tablesorter.min.js"></script>
    <script>
        $(document).ready(function () {
            $(document).on('mouseover', '.qtySoldSpan', function () {
                //$(this).parents('tr').find('.Getproductid').click();
                var row = $(this).parents('tr');
                var ProductSKU = $(row).find('.SKU').val();
                var Url = '/PredictionHistory/GetSoldQtyDays?SKU=' + ProductSKU;
                $.ajax({
                    type: 'Get',
                    url: Url,
                    dataType: 'json',
                    traditional: true,
                    success: function (data, ui) {
                        console.log("Sold Qty", data);
                        var tdContent = '<div class="row"><div class="col-md-5"><b>Days</b></div><div class="col-md-3" style="width:100px;"><b>Qty</b></div><div class="col-md-4"><b>Velocity</b></div>' +
                            '<div class="col-md-5"><span>QtySold15</span></div><div class="col-md-3"><span>' + data.QtySold15 + '</span></div><div class="col-md-4"><span>' + (data.QtySold15 / 15).toFixed(2) + '</span></div>' +
                            '<div class="col-md-5"><span>QtySold30</span></div><div class="col-md-3"><span>' + data.QtySold30 + '</span></div><div class="col-md-4"><span>' + (data.QtySold30 / 30).toFixed(2) + '</span></div>' +
                            '<div class="col-md-5"><span>QtySold60</span></div><div class="col-md-3"><span>' + data.QtySold60 + '</span></div><div class="col-md-4"><span>' + (data.QtySold60 / 60).toFixed(2) + '</span></div>' +
                            '<div class="col-md-5"><span>QtySold90</span></div><div class="col-md-3"><span>' + data.QtySold90 + '</span></div><div class="col-md-4"><span>' + (data.QtySold90 / 90).toFixed(2) + '</span></div>';
                        $(row).find('.QtySold').html(tdContent);
                        $(row).find('.QtySold').toggle('fast')
                    }
                });
            });

            $(document).on('mouseout', '.qtySoldSpan', function () {
                //$(this).parents('tr').find('.Getproductid').click();
                var row = $(this).parents('tr');
                var ProductSKU = $(row).find('.SKU').val();
                var Url = '/PredictionHistory/GetSoldQtyDays?SKU=' + ProductSKU;
                $.ajax({
                    type: 'Get',
                    url: Url,
                    dataType: 'json',
                    traditional: true,
                    success: function (data, ui) {
                        console.log("Sold Qty", data);
                        var tdContent = '<div class="row"><div class="col-md-5"><b>Days</b></div><div class="col-md-3" style="width:100px;"><b>Qty</b></div><div class="col-md-4"><b>Velocity</b></div>' +
                            '<div class="col-md-5"><span>QtySold15</span></div><div class="col-md-3"><span>' + data.QtySold15 + '</span></div><div class="col-md-4"><span>' + (data.QtySold15 / 15).toFixed(2) + '</span></div>' +
                            '<div class="col-md-5"><span>QtySold30</span></div><div class="col-md-3"><span>' + data.QtySold30 + '</span></div><div class="col-md-4"><span>' + (data.QtySold30 / 30).toFixed(2) + '</span></div>' +
                            '<div class="col-md-5"><span>QtySold60</span></div><div class="col-md-3"><span>' + data.QtySold60 + '</span></div><div class="col-md-4"><span>' + (data.QtySold60 / 60).toFixed(2) + '</span></div>' +
                            '<div class="col-md-5"><span>QtySold90</span></div><div class="col-md-3"><span>' + data.QtySold90 + '</span></div><div class="col-md-4"><span>' + (data.QtySold90 / 90).toFixed(2) + '</span></div>';
                        $(row).find('.QtySold').html(tdContent);
                        $(row).find('.QtySold').toggle('fast')
                    }
                });
            });

            //$(document).on("input", "table input", function () {
            //    if ($(this).val() == "") {
            //        $(this).addClass("warning")
            //    } else {
            //        $(this).removeClass("warning")

            //    }
            //}
            $(document).on('mouseover', '.phyqty', function () {
                //$(this).parents('tr').find('.Getproductid').click();
                var row = $(this).parents('tr');
                var ProductSKU = $(row).find('.SKU').val();
                var Url = '/Product/GetWareHousesQtyList?SKU=' + ProductSKU;
                $.ajax({
                    type: 'Get',
                    url: Url,
                    dataType: 'json',
                    traditional: true,
                    success: function (data, ui) {

                        var tdContent = '<div class="row"><div class="col-md-8"><b>Warehouse </b></div><div class="col-md-4"><b>Qty</b></div>';

                        $.each(data, function (key, value) {
                            tdContent = tdContent + '<div class="col-md-8">' +
                                '<span>' + value.WarehouseName + '</span></div>' +
                                '<div class="col-md-4"><span>' + value.AvailableQty + '</span></div><br />';
                        })

                        tdContent = tdContent + '</div>';
                        $(row).find('.phyqtyspan').html(tdContent);
                        $(row).find('.phyqtyspan').toggle('fast')
                    }
                });
            });
            $(document).on('mouseout', '.phyqty', function () {
                var row = $(this).parents('tr');
                var ProductSKU = $(row).find('.SKU').val();
                var Url = '/Product/GetWareHousesQtyList?SKU=' + ProductSKU;
                $.ajax({
                    type: 'Get',
                    url: Url,
                    dataType: 'json',
                    traditional: true,
                    success: function (data, ui) {
                        var tdContent = '<div class="row"><div class="col-md-8"><b>Warehouse </b></div><div class="col-md-4"><b>Qty</b></div>';

                        $.each(data, function (key, value) {
                            tdContent = tdContent + '<div class="col-md-8">' +
                                '<span>' + value.warehouseName + '</span></div>' +
                                '<div class="col-md-4"><span>' + value.physical_qty + '</span></div><br />';
                        })
                        tdContent = tdContent + '</div>';
                        $(row).find('.phyqtyspan').html(tdContent);
                        $(row).find('.phyqtyspan').toggle('fast')
                    }
                });
            });

          
            debugger;

            $(document).on('keyup', '.POQty', function () {
                debugger;
                if ($(this).val()) {
                    var POQty = parseInt($(this).closest('tr').find(".POQty").val());
                    var Velocity = parseFloat($(this).closest('tr').find(".Velocity").val());
                    var OnOrder = parseInt($(this).closest('tr').find(".OnOrder").val());
                    var Approved = parseInt($(this).closest('tr').find(".ApprovedUnitPrice").val());
                    var phyqty = parseInt($(this).closest('tr').find(".PhysicalQty").val());
                    var ReservdQty = parseInt($(this).closest('tr').find(".ReservdQty").val());
                    var days = parseInt(((phyqty + POQty + OnOrder + ReservdQty) / Velocity).toFixed(0));

                    $(this).closest('tr').find(".coverdays").text(days);
                    var amount = parseFloat((POQty) * (Approved)).toFixed(2);
                    $(this).closest('tr').find(".amount").text(amount);
                    var d = new Date();
                    d.setDate(d.getDate() + days);
                    d = $.datepicker.formatDate('M dd yy', new Date(d));
                    $(this).closest('tr').find(".date").text(d);
                }
                else {
                    var d = new Date();
                    d.setDate(d.getDate() + 0);
                    d = $.datepicker.formatDate('M dd yy', new Date(d));
                    $(this).closest('tr').find(".date").text(d);
                }
            });

            $('#headerCheckBox').click(function () {
                if ($(this).is(':checked')) {

                    $(".mytabledroft tbody tr ").each(function () {
                        $(this).find('.checkboxes').attr('checked', true);
                    });

                }
                else {

                    $(".mytabledroft tbody tr ").each(function () {
                        $(this).find('.checkboxes').attr('checked', false);
                    });

                }
            });


            var count = 0;

            $(document).on('click', '#btnAddItem', function () {
                $(".SKU").focus();
                var skuadd = $(this);
                count++;
                if (count<1) {
                    var markup="<tr><td><input type='checkbox' class='checkboxes' id='checkbox' /></td><td></td><td><input type='text' style='box-shadow:none' class='form-control SKU' value='' /></td><td class='SKU'></td><td></td><td class='SKU'></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class=''></td><td class='amount'></td><td class='coverdays' data-id=''></td><td class='date'></td><td><input type='text' class='form-control POQty' /><td> <button type='button' class='btn btn-sm delete' data-id='' style='' value=''><img src='/Images/trash-can-1.1s-128px.png' height='25' /></button></td></tr>";
                $(".mytabledroft tbody").append(markup);
                    $(skuadd).parents('tr').next().find(".SKU").focus();
                }
                var tbody_tr_last = $('.mytabledroft>tbody>tr:last');
                var sku = tbody_tr_last.find(".SKU").val();
                if (sku != '') {
                    var markup="<tr><td><input type='checkbox' class='checkboxes' id='checkbox' /></td><td></td><td><input type='text' style='box-shadow:none' class='form-control SKU' value='' /></td><td class='SKU'></td><td></td><td></td><td class='SKU'></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class=''></td><td class='amount'></td><td class='coverdays' data-id=''></td><td class='date'></td><td><input type='text' class='form-control POQty' /><td> <button type='button' class='btn btn-sm delete' data-id='' style='' value=''><img src='/Images/trash-can-1.1s-128px.png' height='25' /></button></td></tr>";
                $(".mytabledroft tbody").append(markup);
                    $(skuadd).parents('tr').next().find(".SKU").focus();
                }

                else {

                    if (sku == '') {
                        tbody_tr_last.find(".SKU").addClass("warning1");

                    }

                }

            });
            skucount = 0;

            $(document).on('keypress', '.SKU', function (event) {
               
                //var myStr = $(".SKU").val();
                //var trimStr = $.trim(myStr);

                if (event.keyCode == 13) {
                    var skuadd = $(this);
                    var selected = $(this);
                    var data = [];
                    var Obj = {
                        SKU: selected.parents('tr').find('.SKU').val(),
                        VendorId: @Model.VendorId,
                    };
                    data.push(Obj);
                   // console.log(data);

                    skucount++;

                    debugger;
                    $.ajax({
                        type: 'POST',
                        url: '../PredictionHistory/GetDropftPOList',
                        data: { data },
                        success: function (res) {


                            debugger;


                            if (res.VendorId>0) {

                                debugger;
                                var CP = 0;
                                var CP2 = 0;
                                var dfdcp = 0;
                                var dfdcp2 = "0";

                                if (res.CasePackQty > 0) {
                                    dfdcp = parseFloat(res.POQty) / parseFloat(res.CasePackQty);
                                    CP = (dfdcp).toFixed(2) * res.CasePackQty;
                                    CP2 = (dfdcp).toFixed(0) * res.CasePackQty;
                                    dfdcp2 = (dfdcp).toFixed(0) + ".00";
                                }
                                var casepack = "";
                                 if(res.CasePackQty > 0)
                                    {

                                     casepack= "<a href='/ShipmentCasePack/GetTemplateList?SKU="+res.SKU+"' target='_blank' style='cursor:pointer'>"+res.CasePackQty +"</a>";
                                  }
                                  else
                                {
                                     casepack= "<a style='cursor: pointer;' href='/ShipmentCasePack/SaveTemplate?SKU="+res.SKU+"&Vendor=Yes' target='_blank'><span style='color:gray'>CP</span></a>"
                                   }

                                var days = parseInt(((res.PhysicalQty + res.POQty + res.OnOrder + res.ReservedQty) / res.Velocity).toFixed(0));
                                var d = new Date();
                                d.setDate(d.getDate() + days);
                                d = $.datepicker.formatDate('M dd yy', new Date(d));
                                var velocity = parseFloat(res.Velocity).toFixed(2);

                                var amount = parseFloat((res.POQty) * (res.ApprovedUnitPrice)).toFixed(2);
                                $(this).closest('tr').find(".amount").text(amount);
                                var SKU = "<a href='../BestBuyProduct/PropertyPage?ProductSKU=" + res.SKU + "' target='_blank'>" + res.SKU + "</a>" + "<br/>"
                                    var skuimg="<div>" +
                            "<a style='cursor:pointer' href='https://lp.cwa.sellercloud.com/Inventory/Product_Dashboard.aspx?Id="+res.SKU+"'target='_blank'><img height='15px' width='20px' src='/Images/sellercloud-gray.png'/>"+"</a>"+"<a style='margin-left:5px; cursor: pointer;' href='/ApprovedPrice/Index?&sku="+res.SKU+"' target='_blank'><img src='/Images/ok-1.1s-128px.png' class='rounded' height='25'></a>"

                                        + "<a style='cursor:pointer' href='/PurchaseOrder/GetPOProduct?&sku=" + res.SKU + "&EmptyFirstTime=No&POID=&title=&ItemType=OpenItem&orderDateTimeFrom=&orderDateTimeTo='target='_blank'><img src='/Images/right-1.png' height='20'/></a>" + "</div>";
                                var image = '<a target="_blank" href="@ViewBag.S3BucketURL_large/' + res.LargImage + '">' + '<img src="@ViewBag.S3BucketURL/' + res.SmallImage + '" class="rounded" height="50" width="50" /></a>';
                                var inputs = "<input type='text' style='display: none'class='form-control  SKU' value='" + res.SKU + "'><input type='text' style='display: none'class='form-control ApprovedUnitPrice SKU' value='" + res.ApprovedUnitPrice + "'><input type='text' style='display:none' class='form-control ReservdQty' value='" + res.ReservedQty + "'><input type='text' style='display:none' class='form-control Id' value='0'> <input type='text' style='display:none' class='form-control OnOrder' value='" + res.OnOrder + "'><input type='text' style='display:none' class='form-control Velocity' value='" + res.Velocity + "'><input type='text' style='display:none' class='form-control SKU' value='" + res.SKU + "'><input type='text' style='display:none' class='form-control ApprovedUnitPrice' value='" + res.ApprovedUnitPrice + "'><input type='text' style = 'display:none' class='form-control PhysicalQty' value = '" + res.PhysicalQty + "' >";
                                var caspacktd = '<span>' + (dfdcp).toFixed(2) + ' * ' + res.CasePackQty + ' = ' + (CP).toFixed(0) + '</span><br /><span style="color:forestgreen">' + dfdcp2 + ' * ' + res.CasePackQty + ' = ' + CP2.toFixed(0) + '</span><br />'
                                selected.parents('tr').html("<td><input type='checkbox'class='checkboxes'id='checkbox'/>" + inputs + "</td>" + "<td>" + image + "</td>" + "<td class='SKU'>" + SKU + skuimg + "</td>" + "<td class='PhysicalQty SKU'><span class='tooltipphyqty'><span class='phyqty'style='cursor:pointer;color:#007bff;font-size:12px;'>" + res.PhysicalQty + "<span class='topdata phyqtyspan'></span></span></span></td>" + "<td class='ReservdQty'>" + res.ReservedQty + "</td>" + "<td>" + res.OnOrder + "</td>" + "<td class='SKU'><div class='tooltipqtysold'><div class='qtySoldSpan'style='cursor:pointer;color:#007bff;font-size:12px;'>" + res.QtySold60 +"</div><div class='topdata QtySold'></div></div></td>" + "<td class=''>" + res.CoverDays + "</td>" + "<td>" + res.CoverPhy + "</td>" + "<td class='Velocity'>" + velocity + "</td>" + "<td>" + res.POQty + "</td>" + "<td>" + res.LowStock90 + "</td>" + "<td>" + caspacktd + "</td>" + "<td>" + casepack + "</td>" + "<td>" + res.Currency + " " + res.ApprovedUnitPrice.toFixed(2) + "</td>" + "<td class='amount'>" +amount + "</td>" + "<td class='coverdays'>" + days + "</td>" + "<td class='date'>" + d + "</td>" + "<td><input type='text'class='form-control POQty'value=" + res.POQty + "></td>" + "<td><button type='button' class='btn btn-sm delete' data-id='' style='' value=''><img src='/Images/trash-can-1.1s-128px.png' height='25' /></button></td>");


                                // $(".mytabledroft tbody>tr").html("<td><input type='checkbox'class='checkboxes'id='checkbox'/> </td>" + "<td></td>" + "<td>" + res.SKU + "</td>" + "<td>" + res.Currency + res.ApprovedUnitPrice + "</td>" + "<td>" + res.CasePackQty + "</td>" + "<td>" + res.POQty + "</td>" + "<td>" + res.POQty + "</td>" + "<td><input type='text'class='form-control'value=" + res.POQty + "></td>" + "<td>" + res.Velocity + "</td>" + "<td>" + res.CoverDays + "</td>" + "<td>" + res.Velocity + "</td>" + "<td>" + res.date + "</td>" + "<td>" + res.QtySold60 + "</td>" + "<td>" + res.QtySold90 + "</td>" + "<td><button type='button' class='btn btn-sm delete' data-id='' style='' value=''><img src='/Images/trash-can-1.1s-128px.png' height='25' /></button></td>");
                                if (skucount < 1) {

                                    var markup = "<tr><td><input type='checkbox' class='checkboxes' id='checkbox' /></td><td></td><td><input type='text' style='box-shadow:none' class='form-control SKU' value='' /></td><td class='SKU'></td><td></td><td></td><td class='SKU'></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class=''></td><td class='amount'></td><td class='coverdays' data-id=''></td><td class='date'></td><td><input type='text' class='form-control POQty' /><td> <button type='button' class='btn btn-sm delete' data-id='' style='' value=''><img src='/Images/trash-can-1.1s-128px.png' height='25' /></button></td></tr>";
                                    $(".mytabledroft tbody").append(markup);
                                    $(skuadd).parents('tr').next().find(".SKU").focus();
                                }
                                var tbody_tr_last = $('.mytabledroft>tbody>tr:last');
                                var sku = tbody_tr_last.find(".SKU").val();
                                if (sku != '') {
                                    var markup = "<tr><td><input type='checkbox' class='checkboxes' id='checkbox' /></td><td></td><td><input type='text' style='box-shadow:none' class='form-control SKU' value='' /></td><td class='SKU'></td><td></td><td></td><td class='SKU'></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class=''></td><td class='amount'></td><td class='coverdays' data-id=''></td><td class='date'></td><td><input type='text' class='form-control POQty' /><td> <button type='button' class='btn btn-sm delete' data-id='' style='' value=''><img src='/Images/trash-can-1.1s-128px.png' height='25' /></button></td></tr>";
                                    $(".mytabledroft tbody").append(markup);
                                    $(skuadd).parents('tr').next().find(".SKU").focus();
                                }

                                else {

                                    if (sku == '') {
                                        tbody_tr_last.find(".SKU").addClass("warning1");

                                    }

                                }


                                $.notify('Add Items Successfully', { globalPosition: 'bottom right', className: 'Success myclass' });


                            }

                            else  {

                                $.notify('No Approved Price Found!', { globalPosition: 'bottom right', className: 'danger mydlete' });
                            }
                        },
                        Error: function (err) {
                            debugger;
                        }
                    });

                }

            });


            $(".loader").hide();
            $("#dialog-box").dialog({
                autoOpen: false,
                modal: true,
            });

            $(document).on("click", ".delete", function () {
                var selectedRow = $(this);
                var productId = parseInt($(selectedRow).attr('data-id'));
                debugger;
                $("#dialog-box").dialog({
                    buttons: {
                        "Confirm": function () {
                            if (productId > 0) {
                                $(".loader").show();
                                $.ajax({
                                    type: 'Delete',
                                    url: '../PredictionHistory/DeletePOItem?Id=' + productId,
                                    success: function (res) {
                                        debugger;
                                        $(".loader").hide();
                                        $("#dialog-box").dialog("close");
                                        selectedRow.parents('tr').remove();
                                        $.notify('Delete Successfully', { globalPosition: 'bottom right', className: 'danger myclasscancel' });
                                        debugger;
                                    },
                                    Error: function (err) {
                                        debugger;
                                    }
                                });
                            }
                            else {
                                selectedRow.parents('tr').remove();
                            }
                            $(this).dialog("close");
                        },
                        "Cancel": function () {
                            $(this).dialog("close");
                        }
                    }
                })
                $("#dialog-box").dialog("open");
            });

            $(document).on("click", ".deletePO", function () {
                var selectedRow = $(this);
                var InternalPO = @Model.InternalPOID;

                debugger;
                $("#dialog-box").dialog({
                    buttons: {
                        "Confirm": function () {
                                $(".loader").show();
                                $.ajax({
                                    type: 'Delete',
                                    url: '../PredictionHistory/DeletePO?Id=' + InternalPO,
                                    success: function (res) {
                                        debugger;
                                        $(".loader").hide();
                                        $("#dialog-box").dialog("close");
                                        $.notify('Delete Successfully', { globalPosition: 'bottom right', className: 'danger myclasscancel' });
                                        window.location.href='../PredictionHistory/Index';
                                        debugger;
                                    },
                                    Error: function (err) {
                                        debugger;
                                    }
                                });
                            $(this).dialog("close");
                        },
                        "Cancel": function () {
                            $(this).dialog("close");
                        }
                    }
                })
                $("#dialog-box").dialog("open");
            });


            $(document).on('click', '#btnSave', function () {

                //window.open('../PredictionHistory/PredictionList', '_blank');
                $(".loader").show();
                var array = [];
                $('.table tbody tr').each(function () {
                    var skuid = $(this).find('.SKU').val();
                    if (skuid) {
                        var price = $(this).find('.ApprovedUnitPrice').val();
                        array.push({
                            idPurchaseOrdersItems: $(this).find('.Id').val(),
                            SKU: $(this).find('.SKU').val(),
                            POQty: parseInt($(this).find('.POQty').val()),
                            ApprovedUnitPrice: price
                        });
                    }
                });

                var data = {
                    VendorId: '@Model.VendorId',
                    Vendor: '@Model.Vendor',
                    Currency: '@Model.Currency',
                    InternalPOID: '@Model.InternalPOID',
                    Notes: $('#Notes').val(),
                    list: array
                };

                $.ajax({
                    type: 'POST',
                    url: '../PredictionHistory/Save',
                    data: { data },
                    success: function (res) {
                        $(".loader").hide();
                        console.log("data", res);
                        if (res > 0) {
                            $.notify(`Internal PO # ${res} Saved  Successfully`, { globalPosition: 'bottom right', className: 'Success myclass' });
                            window.location.href = '../PredictionHistory/PredictionListDummy?data=' + res;
                        }
                        else {
                            $.notify('Updated Successfully', { globalPosition: 'bottom right', className: 'Success myclass' });
                            window.location.href = '../PredictionHistory/PredictionListDummy?data=@Model.InternalPOID';
                        }
                        //window.location.href = "../PredictionHistory/Index";
                    }
                });
                debugger;
            });

            $(document).on('click', '#btnPost', function () {
                //window.open('../PredictionHistory/PredictionList', '_blank');
                $(".loader").show();
                var array = [];

                $('.table tbody tr').each(function () {
                    var skuid = $(this).find('.SKU').val();
                    if (skuid) {
                    var price = $(this).find('.ApprovedUnitPrice').val();
                    array.push({
                        idPurchaseOrdersItems: $(this).find('.Id').val(),
                        SKU: $(this).find('.SKU').val(),
                        POQty: parseInt($(this).find('.POQty').val()),
                        ApprovedUnitPrice: price
                    });
                }
                });

                var data = {
                    VendorId: '@Model.VendorId',
                    Vendor: '@Model.Vendor',
                    Currency: '@Model.Currency',
                    InternalPOID:'@Model.InternalPOID',
                    Notes: $('#Notes').val(),
                    list: array
                };

                $.ajax({
                    type: 'POST',
                    url: '../PredictionHistory/SaveToSC',
                    data: { data },
                    success: function (res) {
                        $(".loader").hide();
                        if (res > 0) {
                            $(".myclassPostSC").append("<p style='margin-left: 20px;'>PO# " + res +"has been created successfully in SellerCloud!</p>");
                            $("#myModalPostSC").modal({ backdrop: 'static', keyboard: false });
                           /* $.notify(`PO# ${res} has been created successfully in SellerCloud`, { globalPosition: 'bottom right', className: 'Success myclass' *//*});*/
                            window.location.href = "../PurchaseOrder/PurchaseOrdersItems?POId=" + res;
                        }
                        else {
                            $.notify(`Some Error Occure during PO Creation`, { globalPosition: 'bottom right', className: 'Success myclass' });
                        }
                    }
                });
                debugger;
            });

        });
        $(document).on("input", "table input", function () {
            if ($(this).val() == "") {
                $(this).addClass("warning1")
            } else {
                $(this).removeClass("warning1")

            }
        })

    </script>
}