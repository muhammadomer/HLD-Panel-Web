@model Hld.WebApplication.ViewModels.ShipmentHeaderViewModel;
@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_LayoutNavigation.cshtml";
}

    <style>
        .form-group {
            margin-bottom: 0px !important;
        }
        .CardStyle {
            margin-left: 20px;
            margin-top: 5px;
            color: #548b8d
        }

        .Cm-color {
            color: #0099cc !important;
        }

        .Inch-color {
            color: #009900 !important;
        }


        th {
            border-left: 1px solid #555;
            background-color: lightgrey;
            border-right: 1px solid #777;
            border-top: 1px solid #555;
            border-bottom: 1px solid #333;
            box-shadow: inset 0 1px 0 #999;
            /*color: black;*/
            padding: 10px 15px;
            /*position: relative;*/
            text-shadow: 0 1px 0 #000;
        }

        form {
            margin: 20px 0;
        }

            form input, button {
                padding: 5px;
            }

        #myModalMarkShiped {
            margin: 20px;
            margin-top: 88px;
        }

        table {
            background: #f5f5f5;
            box-shadow: inset 0 1px 0 #fff;
            font-size: 11px;
            font-family: Arial;
            line-height: 14px;
            /*margin: 30px auto;*/
            text-align: center;
            width: 100%;
        }

        td {
            border-right: 1px solid #fff;
            border-left: 1px solid #e8e8e8;
            border-top: 1px solid #fff;
            border-bottom: 1px solid #e8e8e8;
            padding: 10px 15px;
            /*position: relative;*/
            transition: all 300ms;
        }

        table, th, td {
            border: 1px solid #cdcdcd;
            text-align: center;
        }

            table th, table td {
                padding: 7px;
                font-size: 12px;
                font-family: Arial;
            }

            table thead tr th {
                position: sticky;
                top: 50px;
                padding: 5px;
                z-index: 2;
                background-color: lightgray;
                vertical-align: top !important;
            }

        .myTable table thead tr th {
            position: sticky;
            top: 50px;
            padding: 5px;
            z-index: 2;
            background-color: lightgray !important;
        }

        .myTable2 thead tr th {
            position: sticky;
            top: 50px;
            padding: 5px;
            z-index: 2;
            background-color: lightgray !important;
        }

        .myclass {
            position: fixed;
            top: 25%;
            left: 85%;
            color: green;
            transform: translate(-50%, -50%);
            box-sizing: border-box;
            padding: 30px;
        }

        .mydelte {
            position: fixed;
            top: 25%;
            left: 85%;
            color: red;
            transform: translate(-50%, -50%);
            box-sizing: border-box;
            padding: 30px;
        }

        .myTable2 th:last-child, .myTable2 th:first-child {
            background-image: url(data:image/gif;base64,R0lGODlhFQAJAIAAACMtMP///yH5BAEAAAEALAAAAAAVAAkAAAIXjI+AywnaYnhUMoqt3gZXPmVg94yJVQAAOw==);
            /*background: none !important;*/
            background-image: none !important;
        }

        .tablesorter-default .tablesorter-header {
            outline: none !important;
        }

        .printshipmentbox {
            font-family: Arial;
            position: absolute;
            top: -1000px;
            width: 1000px;
            height: auto;
        }

        html, body {
            height: 100%;
            margin: 0;
            width: 100%;
        }

        .printshipmentboxall {
            font-family: Arial;
            position: absolute;
            top: -50000px;
            font-weight: bold;
            font-family: Arial;
            height: 1535px;
        }

        .btn-style {
            padding: 3px;
            font-size: 11px;
        }

        .colorhead {
            color: #548b8d;
        }

        @@page {
            margin: 0;
            height: 1535px;
            margin: 0;
            width: 100%;
        }

        .nav-custom-link {
            vertical-align: sub;
            margin-left: 13px;
        }

        .nav-custom-link-box {
            vertical-align: sub;
            margin-left: 5px;
        }

        .hidedialogbox {
            font-family: Arial;
            position: absolute;
            top: 1000px;
            width: 1000px;
            height: auto;
        }

        .myTable2.tablesorter tbody tr:hover td {
            background: #f1f1f1;
            cursor: pointer;
        }
        .table {
            border-left: #ccc 1px solid !important;
            border-right: #ccc 1px solid !important;
        }
    </style>

<div class="modal fade" style="margin-top: 80px!important;" id="myModalMarkShiped" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="display:flex;flex-direction:row-reverse!important">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Mark As Shipped</h4>
            </div>

            @using (Html.BeginForm("CreateShipmentCourier", "Shipment"))
            {<div class="modal-body">
                 <div class="form-group">
                     <label for="inputName"><b>Shipping Courier Code  :</b></label>
                     @*<input type="text" name="CourierCode" class="form-control" id="idCourierCode">*@
                     <input type="text" name="TrakingURL" class="form-control" id="TrakingURL" style="display:none">
                     <select class="form-control" id="DrpDown" style="padding:0px;" name="CourierCode">
                     </select>
                 </div>
                    <div class="form-group">
                        <label for="inputName"><b>Traking Number  :</b></label>
                        <input type="text" name="TrakingNumber" class="form-control" id="idTrakingNumber">
                    </div>
                    <div class="form-group">
                        <label for="inputName"><b>Shipping Date :</b></label>
                        <input type="date" name="CreatedAt" class="form-control" id="idCreatedAt">
                        <input type="text" style="display:none" name="ShipmentId" value="@Model.ShipmentId" class="form-control" id="MarkedShipmentId">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default btncancel" data-dismiss="modal">Cancel</button>
                    <button type="submit" id="btnMarkedAsShipped" class="btn btn-primary btnsave">Save</button>
                </div>
            }
        </div>
    </div>
</div>

<div class="container-fluid">
    @*Header*@
    <div class="container-fluid">

        <div class="card mb-3 mt-3">
            <div style="padding:0px" class="card-header">
                <b class="nav-custom-link">Shipment Details</b>
                <a style="cursor:pointer" class="nav-custom-link-box" asp-action="Create" asp-controller="Shipment">Shipments</a>
                <a style="cursor:pointer" class="nav-custom-link-box" asp-action="Create" asp-controller="ShipmentBox" asp-route-ShipmentId="@Model.ShipmentId"><b>> Boxes </b></a>
                <a style="cursor:not-allowed; text-decoration:none " class="nav-custom-link-box" href="#">> Add Products in Boxes </a>


                <div style="float: right;">

                    @if (Model.Status < 3)
                    {
                        <button ShipmentId="@Model.ShipmentId" class="btn btn-success btn-style MarkedAsShipped">Mark As Shipped</button>
                    }
                    @if (Model.Status < 3 || ViewBag.POMasterID == 1278)
                    {
                        <button class=" btn btn-danger btn-style " id="btnDeleteShipment" value="Delete" style="box-shadow:none"> Delete Shipment </button>
                    }

                </div>

            </div>
            <div class="row ml-0 mt-1 ">
                <div class="col-1">
                    <label class="control-label mb-0 colorhead"><b>Ship from:</b></label>
                    <div class="" style="">

                    </div>
                </div>
                <div class="col-2">
                    <label class="control-label mb-0 colorhead"><b>Shipment Name/ID:</b></label>
                    <div class="" style="">
                        <label class="control-label mb-0 colorhead"><b>ID:</b></label>
                        <label class="mb-0"><a href="/Shipment/Shipmentindex?ShipmentId=@Model.ShipmentId" style="cursor:pointer"><b>@Model.ShipmentId</b></a></label> <br />
                        <label class="control-label mb-0 colorhead"><b>Name:</b></label>
                        @Model.ShipmentName

                    </div>
                </div>
                <div class="col-2">
                    <label class="control-label mb-0 colorhead"><b>Shipping Wt / Volume:</b></label>
                    <div class="" style="">
                        <label class="control-label colorhead mb-0"><b>Gross Wt:</b></label>
                        <label class="control-label mb-0" id="groswt"></label>
                        <br />
                        <label class="control-label colorhead mb-0"><b>CBM:</b></label>
                        <label class="control-label mb-0" id="cbm"></label>
                        <br />
                    </div>
                </div>
                <div class="col-2">
                    <label class="control-label mb-0 colorhead"><b>Shipment Contents:</b></label>
                    <div class="" style="">
                        @*<label class="control-label colorhead"><b>Box ID:</b></label>*@
                        @*@Model.BoxId*@

                        @*<label class="control-label"><b>Dimension:</b></b></label>
                            W x H x L : @Model.Width x @Model.Height x @Model.Length
                            <br>
                            <label class="control-label"><b>Weight:</b></label>
                            @Model.Weight <span>Kg</span>*@
                        <label class="control-label mb-0 colorhead"><b>Qty Shipped:</b></label>
                        <label class="control-label mb-0 " id="totalshipedqty"> </label>
                        <br />
                        <label class="control-label mb-0 colorhead"><b>SKUs: </b></label>
                        <label class="control-label mb-0 " id="totalSKUs"> </label>
                        <label class="control-label mb-0 colorhead"><b>POs: </b></label>
                        <label class="control-label mb-0 " id="totalPOs"> </label>
                        <br />
                        <label class="control-label mb-0 colorhead"><b>Boxes:</b></label>
                        <label class="control-label mb-0 " id="totalBoxes"> </label>
                    </div>
                </div>
                <div class="col-2">
                    <label class="control-label colorhead"><b>Value Reconciliation:</b></label>
                    <div class="" style="">

                    </div>
                </div>
                <div class="col-2">
                    <label class="control-label colorhead"><b>Shipment Status:</b></label>
                    @if (Model.Status == 1)
                    {
                        <span>Open</span>
                    }
                    @if (Model.Status == 2)
                    {
                        <span>In Process</span>
                    }
                    @if (Model.Status == 3)
                    {
                        <span>Shipped</span>
                    }
                    @if (Model.Status == 4)
                    {
                        <span>Receiving in process</span>
                    }
                    @if (Model.Status == 5)
                    {
                        <span>Received</span>
                    }
                    <div class="" style="">

                    </div>
                </div>


            </div>
            <div class=" form-group row ml-0">

                <label class="control-label colorhead" style="margin-left: 15px;"><b>Notes:</b></label>
                <div class="col-sm-10" style="padding-left:2px">
                    @Model.Notes
                </div>
            </div>
        </div>
    </div>

    @*Add Box Table*@
    @if (Model.Status < 3)
    {
        <div class="container-fluid">
            <table class="myTable">
                <thead>
                    <tr>
                        <td></td>
                        <th>Box ID</th>
                        <th class="Cm-color">Width (cm)</th>
                        <th class="Cm-color">Height (cm)</th>
                        <th class="Cm-color">Length (cm)</th>
                        <th class="Cm-color">Weight (kg)</th>
                        <th class="Widthhide Inch-color" style="display:none">Width (Inch)</th>
                        <th class="Heighthide Inch-color" style="display:none">Height (Inch)</th>
                        <th class="Lengthhide Inch-color" style="display:none">Length (Inch)</th>
                        <th class="Weighthide Inch-color" style="display:none">Weight(lbs)</th>
                        @*<th>SKUS</th>
                            <th>Qty</th>*@
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>
                            <input type='text' class='form-control w' value=''>
                        </td>
                        <td>
                            <input type='text' class='form-control h' value=''>
                        </td>
                        <td>
                            <input type='text' class='form-control l' value=''>
                        </td>
                        <td>
                            <input type='text' class='form-control wt' value=''>
                        </td>
                        <td class="Widthhide" style="display:none;">
                            <input type='text' class='form-control wid' value='' readonly style="cursor: not-allowed;">
                        </td>
                        <td class="Heighthide" style="display:none;">
                            <input type='text' class='form-control hei' value='' readonly style="cursor: not-allowed;">
                        </td>
                        <td class="Lengthhide" style="display:none;cursor: not-allowed;">
                            <input type='text' class='form-control len' value='' readonly style="cursor: not-allowed;">
                        </td>
                        <td class="Weighthide" style="display:none;cursor: not-allowed;">
                            <input type='text' class='form-control weight' value='' readonly style="cursor: not-allowed;">
                        </td>
                        @*<td>
                            <input type='text' class='form-control skus' value=''>
                            </td>
                            <td>
                            <input type='text' class='form-control qty' value=''>
                            </td>*@
                    </tr>
                </tbody>
            </table>
            <form>
                <input type="button" class="add-row btn btn-success" value="Add Box">
                <input type="button" id="SubmitData" value="Submit" class="btn btn-primary ml-2">
                <input type="button" class="btn btn-danger" id="btnDeleteTable1" value="Delete">
            </form>
        </div>
    }
<div class="hidedialogbox ">
    <div id="dialog-box">
        <h6 style="color:red ;">Do you want to delete this reocord!</h6>
    </div>
    <div id="dialog-box-Inform">
        <h6 style="color:red">You can not delete shipment until delete all the boxes in this shipment</h6>
    </div>
    <div id="dialog-box-warn">
        <h6 style="color:red">You can not ship because boxes in this shipment are empty Or their dimenions are not given</h6>
    </div>
</div>
    <div class="container-fluid">
        <hr>
        <div class="row ml-0">
            <h6 style="line-height: 1.6!important;">Boxes Summary</h6>
            <span class="col-md-1">
                <input type="button" class="btn btn-danger btn-sm ml-2" id="btnDelete" value="Delete" style="width:65px!important;box-shadow:none;height:26px!important">
            </span>
            <input type="button" class="btn btn-success btn-sm" id="btnPrint" value="Print Box Label" style="box-shadow:none;height:26px!important">
        </div>
        <hr>

        <table class="table  myTable2 tablesorter">
            <thead style="background-color:lightgray;">
                <tr>
                    <th><input type="checkbox" class="checkboxes " id="headerCheckBoxT2" /></th>
                    <th>Box ID</th>
                    <th class="Cm-color">Width<br /> (cm)</th>
                    <th class="Cm-color">Height <br /> (cm)</th>
                    <th class="Cm-color">Length <br /> (cm)</th>
                    <th class="Cm-color">Weight<br /> (kg)</th>

                    <th class="Widthhide Inch-color" style="">Width <br /> (Inch)</th>
                    <th class="Heighthide Inch-color" style="">Height <br /> (Inch)</th>
                    <th class="Lengthhide Inch-color" style="">Length <br /> (Inch)</th>
                    <th class="Weighthide Inch-color" style="">Weight <br /> (lbs)</th>
                    <th>CBM </th>
                    <th>
                        SKU #.
                    </th>
                    <th>
                        PO #.
                    </th>
                    <th>
                        Qty <br /> Shipped
                    </th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.List.Count > 0)
                {
                    @foreach (var item in Model.List)
                    {
                        <tr class="firsttr">
                            <td>
                                <input type='text' style="display:none" class='form-control BoxId' value='@item.BoxId'>
                                <input type="checkbox" class="checkboxes checkbx" id="tbale2checkbox" />
                            </td>
                            <td>

                                <a style="cursor:pointer" asp-action="Index" asp-controller="ShipmentProduct" asp-route-BoxId="@item.BoxId" target="_blank">@item.BoxId</a>


                            </td>
                            <td>

                                <label class="Widthlabel">@item.Width</label>
                                <input type='text' class='form-control Width' value='@item.Width' style="display:none">
                            </td>
                            <td>
                                <label class="Heightlabel">@item.Height</label>

                                <input type='text' class='form-control Height' value='@item.Height' style="display:none">
                            </td>
                            <td>
                                <label class="Lengthlabel">@item.Length</label>
                                <input type='text' class='form-control Length' value='@item.Length' style="display:none">
                            </td>
                            <td>
                                <label class="Weightlabel">@item.Weight</label>
                                <input type='text' class='form-control Weight' value='@item.Weight' style="display:none">
                            </td>
                            <td>
                                @{

                                    double width = Convert.ToDouble(item.Width) * 0.393701;
                                }


                                <label class="Widthlabel2" style="cursor:not-allowed;" readonly>@Math.Round(width, 2)</label>
                                @{

                                    double width1 = Convert.ToDouble(item.Width) * 0.393701;
                                }

                                <input type='text' class='form-control Width1' readonly value='@Math.Round(width1,2)' style="display:none;cursor:not-allowed">
                            </td>
                            <td>
                                @{

                                    double Height = Convert.ToDouble(item.Height) * 0.393701;
                                }

                                <label class="Heightlabel2" style="cursor:not-allowed" readonly>@Math.Round(Height, 2)</label>
                                @{

                                    double Height1 = Convert.ToDouble(item.Height) * 0.393701;
                                }

                                <input type='text' class='form-control Height1' readonly value='@Math.Round(Height1,2)' style="display:none;cursor:not-allowed">
                            </td>
                            <td>
                                @{

                                    double Length = Convert.ToDouble(item.Length) * 0.393701;
                                }
                                <label class="Lengthlabel2" style="cursor:not-allowed" readonly>@Math.Round(Length, 2)</label>
                                @{

                                    double Length1 = Convert.ToDouble(item.Length) * 0.393701;
                                }
                                <input type='text' class='form-control Length1' readonly value='@Math.Round(Length1,2)' style="display:none;cursor:not-allowed">
                            </td>
                            <td>
                                @{

                                    double Weight = Convert.ToDouble(item.Weight) * 2.20462;
                                }
                                <label class="Weightlabel2" style="cursor:not-allowed" readonly>@Math.Round(Weight, 2)</label>
                                @{

                                    double Weight2 = Convert.ToDouble(item.Weight) * 2.20462;
                                }
                                <input type='text' class='form-control Weight2' readonly value='@Math.Round(Weight2,2)' style="display:none;cursor:not-allowed">
                            </td>
                            <td>
                                @{

                                    double CBM = Convert.ToDouble(item.Height * item.Width * item.Length) / 1000000;
                                }
                                <label class="CBM" style="cursor:not-allowed" readonly>@Math.Round(CBM, 4)</label>

                            </td>
                            <td class="SumSKUs">
                                @item.TotalSKUs
                            </td>
                            <td class="SumPOs">
                                @item.TotalPOs
                            </td>
                            <td class="SumShippedQty">
                                @item.TotalShipedQty
                            </td>
                            <td style="width:235px">
                                @if (Model.Status < 3)
                                {
                                    <a data-ID="@item.BoxId" style="cursor:pointer" title="Print Label" class=" print"><img src="~/Images/print-1.1s-128px.png" height="25" /></a>
                                    <button type="button" class=" btn btn-success btn-style Editbtn">Edit</button>
                                    <a href="../ShipmentProduct/Index?BoxId=@item.BoxId" target="_blank" class="btn btn-success ml-2 btn-style">Add Product</a>
                                }
                                else
                                {
                                    <a data-ID="@item.BoxId" style="cursor:pointer" title="Print Label" class=" print"><img src="~/Images/print-1.1s-128px.png" height="25" /></a>
                                    <a href="../ShipmentProduct/Index?BoxId=@item.BoxId" target="_blank" class="btn btn-success ml-2 btn-style">View Box</a>
                                }
                            </td>
                        </tr>
                    }
                }
                else
                {


                }
            </tbody>
        </table>
    </div>
</div>
@section Scripts{
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function () {
            function loadBoxes() {
                $.ajax({
                    type: 'GET',
                    url: '../ShipmentCourier/CourierDetailGet',
                    data: {},
                    success: function (res) {

                        $("#DrpDown").html("");
                        var content = '';
                        $.each(res, function (index, value) {
                            content = content + '<option value = "' + value.CourierCode + '" data-URL="' + value.TrakingURL + '" class="optionn" >' + value.CourierCode + '</option>';
                        });
                        $("#DrpDown").append(content);
                        @*// $("#DrpDown").val('@Model.BoxId');*@
                }
                });
            }
            debugger;
            $(document).on('change', '#DrpDown :selected', function () {
                debugger;
                var TrakingURL = $(this).find(".optionn").attr("data-URL");
                $("#TrakingURL").val(TrakingURL);
                console.log(TrakingURL)
            });
               $("#dialog-box").dialog({
                autoOpen: false,
                //title: 'Are u want to delete this reocord!',
                modal: true,


            });
            $("#dialog-box-Inform").dialog({
                autoOpen: false,
                //title: 'Are u want to delete this reocord!',
                modal: true,


            });
            $("#dialog-box-warn").dialog({
                autoOpen: false,
                //title: 'Are u want to delete this reocord!',
                modal: true,
            });
            $("#btnPrint").hide();
            $("#btnPrint").click(function () {
                var data = [];
                debugger;
                $(".myTable2 tbody tr ").each(function () {
                    var checkbox = $(this).find('.checkbx');
                    if ($(checkbox).is(":checked")) {
                        //var Obj = {
                        //    BoxId: $(this).find(".tdBoxId").val(),
                        //};
                        data.push($(this).find(".BoxId").val());
                    }
                });
                $.ajax({
                    type: 'POST',
                    url: '../ShipmentBox/DownloadBoxLabels',
                    data: { data },
                    success: function (res) {
                        $.notify('Printed Successfully', { globalPosition: 'bottom right', className: 'danger mydelte' });

                        var sampleArr = base64ToArrayBuffer(res.Content);
                        saveByteArray("Multiple-Box-Label", sampleArr);

                    },
                    Error: function (err) {
                        $.notify('some error occured!', { globalPosition: 'bottom right', className: 'error mydelte' });
                    }
                });

            });
            function base64ToArrayBuffer(base64) {
                var binaryString = window.atob(base64);
                var binaryLen = binaryString.length;
                var bytes = new Uint8Array(binaryLen);
                for (var i = 0; i < binaryLen; i++) {
                    var ascii = binaryString.charCodeAt(i);
                    bytes[i] = ascii;
                }
                return bytes;
            };
            function saveByteArray(reportName, byte) {
                var blob = new Blob([byte], { type: "application/pdf" });
                var link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                var fileName = reportName;
                link.download = fileName;
                link.click();
            };
            function datetimeboxall() {
                var d = new Date();
                var month = d.getMonth() + 1;
                var day = d.getDate();

                var output = d.getFullYear() + '-' +
                    (('' + month).length < 2 ? '0' : '') + month + '-' +
                    (('' + day).length < 2 ? '0' : '') + day;

                $('.currentdateboxall').text(output);
            }
            //$(".print").click(function () {
            $(document).on("click", ".print", function () {

                var data = [];

                data.push($(this).attr("data-ID"));

                $.ajax({
                    type: 'POST',
                    url: '../ShipmentBox/DownloadBoxLabels',
                    data: { data },
                    success: function (res) {
                        $.notify('success', { className: 'success ' });
                        var sampleArr = base64ToArrayBuffer(res.Content);
                        saveByteArray(data[0], sampleArr);
                    },
                    Error: function (err) {
                        $.notify('some error occured!', { className: 'error ' });
                    }
                });
            });


            function datetimebox() {
                var d = new Date();

                var month = d.getMonth() + 1;
                var day = d.getDate();

                var output = d.getFullYear() + '-' +
                    (('' + month).length < 2 ? '0' : '') + month + '-' +
                    (('' + day).length < 2 ? '0' : '') + day;

                $('#currentdatebox').text(output);
            }

            $(".myTable2").tablesorter();


            $('#headerCheckBoxT2').click(function () {
                if ($(this).is(':checked')) {
                    //$('.checkbx').attr('checked', true);
                    $(".myTable2 tbody tr ").each(function () {
                        $(this).find('.checkbx').attr('checked', true);
                    });
                    $("#btnPrint").show();
                }
                else {
                    //$('.checkbx').attr('checked', false);
                    $(".myTable2 tbody tr ").each(function () {
                        $(this).find('.checkbx').attr('checked', false);
                    });
                    $("#btnPrint").hide();
                }
            });

            $("#btnDelete").hide();
            $("#btnDeleteTable1").hide();
            $('.myTable2 tbody tr').each(function () {
                //$(this).find('input').prop('readonly', true);
            });
            $(document).on('click  .checkbx2', function () {
                var found = false;
                //debugger;
                $(".myTable tbody tr ").each(function () {
                    //debugger;
                    var checkbox = $(this).find('.checkbx2');
                    if ($(checkbox).is(":checked")) {
                        found = true
                    }
                });
                if (found) {
                    $("#btnDeleteTable1").show();
                }
                else {
                    $("#btnDeleteTable1").hide();
                }
            });
            $(".checkbx").click(function () {
                var found = false;
                //debugger;
                $(".myTable2 tbody tr ").each(function () {
                    //debugger;
                    var checkbox = $(this).find('.checkbx');
                    if ($(checkbox).is(":checked")) {
                        found = true
                    }
                });
                if (found) {
                    $("#btnPrint").show();
                }
                else {
                    $("#btnPrint").hide();
                }
            });

            $("#btnDeleteTable1").click(function () {

                $("#dialog-box").dialog({
                    buttons: {
                        "Confirm": function () {
                            var data = [];
                            $(".myTable tbody tr ").each(function () {
                                var checkbox = $(this).find('.checkbx2');
                                if ($(checkbox).is(":checked")) {
                                    //debugger;
                                    var Obj = {
                                        BoxId: $(this).find(".tdBoxId").val(),
                                    };
                                    data.push(Obj)
                                    $(this).remove();
                                }
                            });
                            $.ajax({
                                type: 'POST',
                                url: '../ShipmentBox/Delete',
                                data: { data },
                                success: function (res) {
                                    $("#dialog-box").dialog("close");
                                    $.notify('Delete Successfully', { globalPosition: 'bottom right', className: 'danger mydelte' });
                                },
                                Error: function (err) {
                                    $.notify('some error occured!', { globalPosition: 'bottom right', className: 'error mydelte' });

                                }
                            });
                        },
                        "Cancel": function () {
                            $(this).dialog("close");
                            $.notify('Cancel Successfully ', { globalPosition: 'bottom right', className: 'warning mydelte' });
                        }
                    }
                });

                $("#dialog-box").dialog("open");


            });
            $("#btnDeleteShipment").click(function () {
                debugger;
                $("#dialog-box").dialog({
                    buttons: {
                        "Confirm": function () {
                            var data = {
                                ShipmentId: '@Model.ShipmentId',
                            };
                            $.ajax({
                                type: 'POST',
                                url: '../Shipment/Delete',
                                data: { data },
                                success: function (res) {
                                    $("#dialog-box").dialog("close");
                                    $.notify('Delete Successfully', { className: 'danger mydelte' });
                                    location.href = '../Shipment/Create';
                                },
                                Error: function (err) {
                                    $.notify('some error occured!', { className: 'error mydelte' });
                                }
                            });

                        },
                        "Cancel": function () {
                            $(this).dialog("close");
                            $.notify('Cancel Successfully ', { globalPosition: 'bottom right', className: 'warning mydelte' });
                        }
                    }
                });
                debugger;

                if (($('.myTable2 tbody tr').length > 0 || $('.myTable tbody tr').length > 1)) {
                    $("#dialog-box-Inform").dialog("open");
                }
                else
                {
                      $("#dialog-box").dialog("open");
                }
            });
            $(document).on("blur", ".Width", function () {

                $(".Width1").val(($(this).val() * 0.393701).toFixed(2));

            });

             function sumAll() {
                var sumSkus = 0;
                var sumPOs = 0;
                var sumShippedQty = 0;
                 var Weight = 0;
                 var CBM = 0;

                 $(".myTable2 tbody tr ").each(function () {
                     sumShippedQty = sumShippedQty + parseInt($(this).find('.SumShippedQty').text());
                    sumPOs = sumPOs + parseInt($(this).find('.SumPOs').text());
                    sumSkus = sumSkus + parseInt($(this).find('.SumSKUs').text());
                    Weight = Weight + parseInt($(this).find('.Weight').val()); 
                     CBM=CBM+((parseInt($(this).find('.Width').val())*parseInt($(this).find('.Height').val())*parseInt($(this).find('.Length').val()))/1000000)
                });

                 if (isNaN(sumShippedQty)) { $("#totalshipedqty").text(0); }
                 else { $("#totalshipedqty").text(sumShippedQty); }
                 if (isNaN(sumSkus)) {   $("#totalSKUs").text(0); } else {    $("#totalSKUs").text(sumSkus);}

                    if (isNaN(sumPOs)) {   $("#totalPOs").text(0); } else {    $("#totalPOs").text(sumPOs);}

                 $("#cbm").text(CBM.toFixed(3));

                $("#groswt").text(Weight +' Kgs');

                $("#totalBoxes").text($('.myTable2 tbody tr').length);


            }

            sumAll();


            $(document).on("blur", ".Height", function () {

                $(".Height1").val(($(this).val() * 0.393701).toFixed(2));

            });
            $(document).on("blur", ".Length", function () {

                $(".Length1").val(($(this).val() * 0.393701).toFixed(2));

            });

             $(document).on("blur", ".Weight", function () {

                $(".Weight2").val(($(this).val() * 2.20462).toFixed(2));

            });

            $(".Editbtn").click(function () {
                if ($(this).text() == 'Edit') {
                    $(this).parents('tr').find('input').show();
                    $(this).parents('tr').find('label').hide();

                    $(this).parents('tr').find('.BoxId').hide();


                    $(this).text("Save");
                }
                else {



                    $(this).parents('tr').find('.BoxId').hide();

                    $(this).text("Edit");
                    var data = {
                        Width: parseFloat($(this).parents('tr').find('.Width').val()),
                        Height: parseFloat($(this).parents('tr').find('.Height').val()),
                        Length: parseFloat($(this).parents('tr').find('.Length').val()),
                        Weight: parseFloat($(this).parents('tr').find('.Weight').val()),
                        BoxId: $(this).parents('tr').find('.BoxId').val(),

                    };
                    console.log("Data", data);
                    var labeldata = $(this).parents('tr');


                    $.ajax({
                        type: 'POST',
                        url: '../ShipmentBox/UpdateBox',
                        data: { data },
                        //contentType: 'application/json',
                        //dataType: 'json',
                        success: function (res) {


                            //$(".Widthlabel2").val(($(this).val() * 0.393701).toFixed(2));
                            $(labeldata).find('.Widthlabel2').text($(labeldata).find('.Width1').val());
                            $(labeldata).find('.Heightlabel2').text($(labeldata).find('.Height1').val());
                            $(labeldata).find('.Lengthlabel2').text($(labeldata).find('.Length1').val());


                            $(labeldata).find('.Widthlabel').text($(labeldata).find('.Width').val());
                            $(labeldata).find('.Heightlabel').text($(labeldata).find('.Height').val());
                            $(labeldata).find('.Lengthlabel').text($(labeldata).find('.Length').val());
                            $(labeldata).find('.Weightlabel').text($(labeldata).find('.Weight').val());
                            $(labeldata).find('.Weightlabel2').text($(labeldata).find('.Weight2').val());

                            $.notify('Save Successfully',{globalPosition: 'bottom right', className: 'success myclass'});

                            $(labeldata).find('input').hide();
                            $(labeldata).find('label').show();
                            $(labeldata).find('.checkboxes').show();



                        },

                        Error: function (err) {
                        }

                    });
                }
            });
            $("#SubmitData").click(function () {
                var data = [];
                $(".myTable tbody tr ").each(function () {
                    Obj = {};
                    var Width = $(this).find(".input1").val();
                    var Height = $(this).find(".input2").val();
                    var Length = $(this).find(".input3").val();
                    var Weight = $(this).find(".input4").val();
                    var BoxId = $(this).find(".tdBoxId").val();
                    if (Width != undefined) {
                        Obj.Width = parseFloat(Width);
                        Obj.Height = parseFloat(Height);
                        Obj.Length = parseFloat(Length);
                        Obj.Weight = parseFloat(Weight);
                        Obj.BoxId = BoxId;
                        data.push(Obj);

                    }
                });
                $.ajax({
                    type: 'POST',
                    url: '../ShipmentBox/Update',
                    data: { data },
                    //contentType: 'application/json',
                    //dataType: 'json',
                    success: function (res) {
                        //debugger;

                            $.notify('Save Successfully', { globalPosition: 'bottom right', className: 'success myclass' });



                        //debugger;
                        location.reload();
                    },
                    Error: function (err) {
                        //debugger;
                    }
                });
            });
            var getUrlParameter = function getUrlParameter(sParam) {
                var sPageURL = window.location.search.substring(1),
                    sURLVariables = sPageURL.split('&'),
                    sParameterName,
                    i;

                for (i = 0; i < sURLVariables.length; i++) {
                    sParameterName = sURLVariables[i].split('=');

                    if (sParameterName[0] === sParam) {
                        return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                    }
                }
            };


            $(document).on("blur", ".w", function () {
                $(".input1").val($(this).val());
                var width = ($('.input1').val() * 0.393701);
                $(".input5").val(width.toFixed(2));
            });

            $(document).on("blur", ".h", function () {
                $(".input2").val($(this).val());
                var height = ($(".input2").val() * 0.393701);
                $('.input6').val(height.toFixed(2));

            });
            $(document).on("blur", ".l", function () {
                $(".input3").val($(this).val());
                var length=($(".input3").val() * 0.393701);
            $('.input7').val(length.toFixed(2))
            });

            $(document).on("blur", ".w", function () {
                $(".input5").val(($(this).val() * 0.393701).toFixed(2));
            });

            $(document).on("blur", ".input1", function () {

                $(this).closest('tr').find(".input5").val(($(this).val() * 0.393701).toFixed(2));

            });
            $(document).on("blur", ".input2", function () {

                $(this).closest('tr').find(".input6").val(($(this).val() * 0.393701).toFixed(2));
            });
            $(document).on("blur", ".input3", function () {
                $(this).closest('tr').find(".input7").val(($(this).val() * 0.393701).toFixed(2));
            });


            $(document).on("blur", ".h", function () {
                $(".input6").val(($(this).val() * 0.393701).toFixed(2));
            });


            $(document).on("blur", ".l", function () {
                $(".input7").val(($(this).val() * 0.393701).toFixed(2));
            });
             $(document).on("blur", ".wt", function () {
                $(".input4").val($(this).val());
                var length = ($(".input4").val() * 2.20462);
                $('.input8').val(length.toFixed(2))
            });
            $(document).on("blur", ".wt", function () {
                $(".input8").val(($(this).val() * 2.20462).toFixed(2));
            });
            $(document).on("blur", ".input4", function () {

                $(this).closest('tr').find(".input8").val(($(this).val() * 2.20462).toFixed(2));

            });

          $(".btnMarkedAsShipped").click(function () {
                $('#myModalMarkShiped').modal('hide');
                $.notify('Marked As Shipped successfully', { globalPosition: 'bottom right', className: 'success myclass' });

            });
          //$(document).on('click', '.MarkedAsShipped', function () {

          //  $("#MarkedShipmentId").val($(this).attr("ShipmentId"));
          //  $('#myModalMarkShiped').modal('show');
          //  $(this).find('input[type="text"]').focus();
          //});

              $(".MarkedAsShipped").click(function () {
                //console.log("Mark As shiped");
                var Found = false;
                var i = 0;
                $('.myTable2 tbody tr').each(function () {
                    debugger;

                    var data = {
                        Width: parseFloat($(this).find('.Width').val()),
                        Height: parseFloat($(this).find('.Height').val()),
                        Length: parseFloat($(this).find('.Length').val()),
                        Weight: parseFloat($(this).find('.Weight').val()),
                        BoxId: $(this).find('.BoxId').val(),
                        ShippedQty: parseFloat($(this).find('.SumShippedQty').text()),
                    };
                    if (data.Width === 0) {
                        Found = true;
                        return false;
                    }
                    if (data.Height === 0) {
                        Found = true;
                        return false;
                    }
                    if (data.Length === 0) {
                        Found = true;
                        return false;
                    }
                    if (data.Weight === 0) {
                        Found = true;
                        return false;
                    }
                    if (data.ShippedQty === 0) {
                        Found = true;
                        return false;
                    }
                    if (data.Weight!='undefined') {
                        i++;
                    }

                });

                if (Found || i===0) {
                     $("#dialog-box-warn").dialog("open");
                }
                else {
                    $("#MarkedShipmentId").val($(this).attr("ShipmentId"));
                    loadBoxes();
                    $('#myModalMarkShiped').modal('show');

                    $(this).find('input[type="text"]').focus();
                  }

            });

            //$(".delete-row").click(function () {
            //    $("table tbody").find('input[name="record"]').each(function () {
            //        if ($(this).is(":checked")) {
            //            alert("Are u want to remove");
            //            ($(this).parents("tr").remove()
            //            );

            //        }
            //    });
            //});
            var rowCount = $('.myTable >tbody >tr').length;
            if (rowCount == 1) {
                $('.w').prop('readonly', true);
                $('.h').prop('readonly', true);
                $('.l').prop('readonly', true);
                $('.wt').prop('readonly', true);

            }
            var i = 0;
            var BoxId = "";
            var Url = "";
            $(".add-row").click(function () {
                $('.Widthhide').show();
                $('.Lengthhide').show();
                $('.Heighthide').show();
                 $('.Weighthide').show();
                $('.wid').prop('readonly', true);
                $('.hei').prop('readonly', true);
                $('.len').prop('readonly', true);
                i++;
                //debugger;
                var Id = getUrlParameter("ShipmentId");
                console.log("ShipmentId", Id);
                $.ajax({
                    type: 'GET',
                    url: '../ShipmentBox/CreateBox?Id=' + Id,
                    contentType: 'application/json',
                    success: function (res) {
                        BoxId = res;

                        $('.w').prop('readonly', false);
                        $('.h').prop('readonly', false);
                        $('.l').prop('readonly', false);
                        $('.wt').prop('readonly', false);
                        $('.skus').prop('readonly', false);
                        $('.qty').prop('readonly', false);

                        var markup = "<tr><td><input type='checkbox' class='checkbx2' id='tbale1checkbox' /></td><td style='width:185px;min-width:185px'><input type='text' class='form-control tdBoxId' style='display:none' value='" + BoxId + "'><span class='ml-2'>" + BoxId + "</span></td><td><input type='text'class='form-control input1' value=''></td><td><input type='text'class='form-control input2' value=''></td><td><input type='text'class='form-control input3' value=''></td><td><input type='text'class='form-control input4' value=''></td><td><input type='text'class='form-control input5'readonly value=''style='cursor:not-allowed;'></td><td><input type='text'class='form-control input6' readonly value=''style='cursor:not-allowed;'></td><td><input type='text'class='form-control input7'readonly value=''style='cursor:not-allowed;'></td><td><input type='text'class='form-control input8'readonly value=''style='cursor:not-allowed;'></td></tr>";
                        $(".myTable tbody").append(markup);
                        //$.notify('Add Row Successfully', { globalPosition: 'bottom right', className: 'success myclass' });
                    }
                });
            });
        });


    </script>
}
