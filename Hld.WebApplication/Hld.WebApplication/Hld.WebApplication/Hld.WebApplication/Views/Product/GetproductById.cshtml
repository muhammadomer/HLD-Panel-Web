@model Hld.WebApplication.ViewModel.GetParentSkuById

@{
    ViewData["Title"] = "GetproductById";
}



<style>
    form {
        margin: 20px 0;
    }

        form input, button {
            padding: 5px;
        }

    .form-group {
        margin-bottom: 0px !important;
    }

    table {
        width: 100%;
        margin-bottom: 20px;
        border-collapse: collapse;
    }

    table, th, td {
        border: 1px solid #cdcdcd;
    }

        table th, table td {
            padding: 10px;
            text-align: left;
        }

        table thead tr th {
            vertical-align: top !important;
        }

    .warning {
        border: 1px solid red;
    }

    .myclass {
        position: fixed;
        top: 25%;
        left: 85%;
        color: green;
        transform: translate(-50%, -50%);
        box-sizing: border-box;
        padding: 30px;
    }

    .mydelte {
        position: fixed;
        top: 25%;
        left: 85%;
        color: red;
        transform: translate(-50%, -50%);
        box-sizing: border-box;
        padding: 30px;
    }

    .colorhead {
        color: #548b8d;
    }

    .btn-style {
        padding: 3px;
        font-size: 11px;
    }

    .nav-custom-link {
        vertical-align: sub;
        margin-left: 13px;
    }

    .nav-custom-link-box {
        vertical-align: sub;
        margin-left: 5px;
    }

    .hideclass {
        top: 1000px;
    }

    .table {
        border-left: #ccc 1px solid !important;
        border-right: #ccc 1px solid !important;
        border-bottom: #ccc 1px solid !important;
    }
    .form-control {
        padding: 0px;
    }

    input[type="file"] {
        display: block;
    }

    .imageThumb {
        height: 75px;
        width: 75px;
        padding: 1px;
        cursor: pointer;
    }

    .pip {
        display: inline-block;
        margin: 10px 10px 0 0;
    }

    .remove {
        width: 75px;
        display: block;
        background: #444;
        border: 1px solid black;
        color: white;
        text-align: center;
        cursor: pointer;
    }

        .remove:hover {
            background: white;
            color: black;
        }

    .requiredCustomClass {
        color: red;
    }

    .col-sm-3, .col-sm-8 {
        padding-right: 3px;
    }

    .form-control {
        box-shadow: none !important;
    }

    .btn {
        vertical-align: initial !important;
    }

    .warning {
        border: 1px solid red;
    }
</style>

<div class="container-fluid"style="margin-bottom:40px">
    <div class="card mt-5">
        <div style="padding:0px" class="card-header">
            <b style="vertical-align: sub; margin-left: 13px;">Add Multiple SKU</b>

        </div>
        <div class="row ml-0">

            <div class="col-4 mt-2 mb-2">

                <div class="mt-2" style="">
                    <label class="control-label mb-0 colorhead"><b>Parent SKU:</b></label>
                    <span class="AddSku">@Model.Sku</span>
                   
                </div>
            </div>
            <div class="col-8 mt-2 mb-2">
                <div class="mt-2" style="">
                    <label class="control-label mb-0 colorhead"><b>Title:</b></label>
                    <span class="AddTitle">@Model.ProductTitle</span>
                  
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid"style="padding:0">
 
            <div class=""style="padding:0">
                <label class="" style="font-weight:bold;margin-left:15px">Add Colors</label>
                <div class="col-sm-12">
                    <table class="table table-bordered ">
                        <thead style="background-color:lightgray">
                            <tr>
                                <th style=" width: 10%;">Color</th>
                                <th>SKU</th>
                                <th style="width: 45%;">Title</th>
                                <th>UPC</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                          
                                <tr>
                                    <td>
                                        <input type="search" class="form-control AddColor" id="Color" name="Color" placeholder="Color" value='' />
                                       
                                        <input type='text' style="display:none" class='form-control AddSku' value='@Model.Sku'>
                                        <input type='text' style="display:none" class='form-control ColorId' value=''>
                                        <span style="color:red;padding-left:0px;" id="empty-message-Color"></span> <span class="requiredCustomClass" style="float: right;">*</span>
                                        @*@Html.HiddenFor(e => Model.ColorId, htmlAttributes: new { @id = "ColorIdForMessage" })*@
                                        <input type='text' style="display:none" class='form-control ColorAlias' name="ColorAlias" value=''>
                                        <input type='text' style="display:none" class='form-control AddSku' value='@Model.Sku'>
                                        <input type='text' style="display:none" class='form-control productstatus' value='@Model.productstatus'>
                                        <input type='text' style="display:none" class='form-control product_id' value='@Model.product_id'>

                                    </td>
                                    <td>
                                        <input type="text" class="form-control AddSku" placeholder="SKU" />
                                       
                                    </td>
                                    <td><input type="text" class="form-control AddTitle" placeholder="Title" value='' /></td>
                                    <td><input type="text" class="form-control AddUpc" placeholder="UPC" /></td>
                                    <td>
                                        @*<button type='button' class='btn btn-success addproduct'>Save</button>*@
                                        <button type='button' class='btn btn-sm delete' data-id='' style='' value=''><img src='/Images/trash-can-1.1s-128px.png' height='25' /></button>
                                    </td>
                                </tr>
                                
                            </tbody>
                    </table>
                    <button class=" btn btn-primary btn-style " id="btnAddItem" value="" style="box-shadow:none;float:left"> Add Item</button>
                    @*<input type="submit" name="action" id="InputSubmit" value="Submit" class="btn btn-primary" style="float:right" />*@
                    <button class=" btn btn-success" id="btnSave" value="" style="        box-shadow: none;
        float: right;
        margin-left: 3px"> Save</button>
                </div>
            </div>
        </div>
    
@section Scripts{
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

<script type="text/javascript">



        $(document).ready(function () {
            debugger;
            var ColorId = 0;
            function autocolor() {
                $('.AddColor').autocomplete({
                    autoFocus: true,
                    source: function (request, response) {
                        $.ajax({
                            url: "/Product/GetAlColorForAutoComplete",
                            type: "POST",
                            minLength: 3,
                            dataType: "json",
                            data: { Prefix: request.term },
                            success: function (data, ui) {

                                //if (data.length > 0) {
                                response($.map(data, function (item) {
                                    if (item != null) {
                                        return { label: item.Name, value: item.Name, ColorAlias: item.ColorAlias, id: item.ID };
                                    }

                                }));
                            }
                        })
                    },
                    select: function (event, ui) {

                        $('#ColorIdForMessage').val(ui.item.id);
                        $('.ColorAlias').val(ui.item.ColorAlias);
                        $(this).parents('tr').find('.ColorId').val(ui.item.id);

                    },
                    response: function (event, ui) {
                        console.dir(ui.content)
                        if (ui.content.length === 0) {
                            $("#empty-message-Color").text("No results found");
                            $('#ColorIdForMessage').val("0");

                            $('#InputSubmit').attr("disabled", true)
                        } else {
                            $("#empty-message-Color").empty();
                            $('#InputSubmit').attr("disabled", false)
                        }
                    }
                });
            }
            debugger;
            //$('.AddColor').change(function () {
            //    var topsku = $("#SKU").val();
            //    //var AddColor = $(".AddColor").val();
            //    var title = $("#ProductTitle").val();
            //    var AddColor = $(".AddColor").val();;
            //    var res = AddColor.charAt(0)
            //    var a = AddColor.substr(AddColor.length - 1);
            //    $(this).closest('tr').find(".AddSku").val(topsku + "-" + res + a);
            //    $(this).closest('tr').find(".AddTitle").val(title + "[" + AddColor);
            //});
            debugger;

            $('.AddColor').change(function () {

                var topsku = $(".AddSku").html();
                var title = $(".AddTitle").html();
                //var AddColor = $(".AddColor").val();
                //var ColorAlias = $('.ColorAlias').val();
                var AddColor = $(this).closest('tr').find(".AddColor").val();

                var ColorAlias = $(this).closest('tr').find('.ColorAlias').val();
                ColorId = $(this).closest('tr').find('.ColorId').val();
                console.log("gggg", ColorId);
                $(this).closest('tr').find(".AddSku").val(topsku + "-" + ColorAlias);
                $(this).closest('tr').find(".AddTitle").val(title + " [ " + AddColor + " ]");

            });
            function addsku(){
                $('.AddColor').change(function () {

                        //var topsku = $("#SKU").val();
                        //var title = $("#ProductTitle").val();
                    var topsku = $(".AddSku").html();
                    var title = $(".AddTitle").html();
                    ColorId = $(this).closest('tr').find('.ColorId').val();
                    console.log("gggg", ColorId);
                    var AddColor = $(this).closest('tr').find(".AddColor").val();
                    var ColorAlias = $(this).closest('tr').find('.ColorAlias').val();
                        $(this).closest('tr').find(".AddSku").val(topsku + "-" + ColorAlias);
                        $(this).closest('tr').find(".AddTitle").val(title + " [ " + AddColor + " ]");
                    });
            }
            function AddMarkup() {

                var markup = "<tr><td><input type='text'style='display:none' class='form-control product_id' value='" +@Model.product_id+"'><input type='text' style='display:none' class='form-control productstatus' value='" +@Model.productstatus+"'><input type='text' style='display: none' class='form-control ColorId' value=''><input type='search' class='form-control AddColor' id='Color' name='Color' placeholder='Color'/><input type='text' style='display:none' class='form-control ColorAlias' name='ColorAlias' value=''><input type='text' style='display:none' class='form-control AddSku' value=''><span style='color:red;padding-left:0px;'id='empty-message-Color'></span></td><td><input type='text' class='form-control AddSku' placeholder='SKU'/><input type='text' style='display:none' class='form-control AddSku' value=''></td><td><input type='text' class='form-control AddTitle' placeholder='Title' /></td><td><input type='text' class='form-control AddUpc' placeholder='UPC'/></td><td><button type='button'class='btn btn-sm delete' data-id='' style='' value=''><img src='/Images/trash-can-1.1s-128px.png' height='25' /></button></td></tr>";
                $("table tbody").append(markup);

            }
            var count = 0;
            $("#btnAddItem").click(function() {

                count++;
                if (count<1) {
                    AddMarkup()
                    autocolor();
                    addsku();
                }
                var tbody_tr_last = $('table>tbody>tr:last');
                var color = tbody_tr_last.find(".AddColor").val();
                var sku = tbody_tr_last.find(".AddSku").val();
                var title = tbody_tr_last.find(".AddTitle").val();
                //<span class='requiredCustomClass' style='float:right;'>*</span>
                if (color != '' && sku != '' && title != '') {
                    AddMarkup()
                   autocolor();
                   addsku();


                }
                else {
                    if (color == '') {
                        tbody_tr_last.find(".AddColor").addClass('warning')
                    }
                    if (sku == '') {
                        tbody_tr_last.find(".AddSku").addClass('warning')
                    }
                    if (title == '') {
                        tbody_tr_last.find(".AddTitle").addClass('warning')
                    }
                }
            });
            //new work


            //end

            $(document).on("input", "table input", function () {
                if ($(this).val() == "") {
                    $(this).addClass("warning")
                } else {
                    $(this).removeClass("warning")

                }
            })
            if ($('#HfProductId').length > 0) {
                $.get('/Product/ShowImages/' + $('#HfProductId').val() + '').done(function (response) {
                    $('#imagesDivMainView').html(response);
                });
            }
            debugger
                 $(document).on('click', '#btnSave', function () {
                     debugger
                     var data = [];
                     $('table tbody tr ').each(function () {


                         var Obj =
                         {
                             Sku: $(this).find('.AddSku').val(),
                             product_id: $(this).find('.product_id').val(),
                             productstatus: $(this).find('.productstatus').val(),
                             title: $(this).find(".AddTitle").val(),
                             upc: $(this).find(".AddUpc").val(),
                             ColorIds: $(this).find(".ColorId").val(),
                         };
                         data.push(Obj);
                         console.log("get data", data)

                     });
                $.ajax({
                    type: 'POST',
                    url: '..//',
                    data: {},
                    success: function (res) {
                        $(".loader").hide();
                        console.log("data", res);
                        if (res > 0) {

                        }
                        else {

                        }

                    }
                });
                debugger;
            });

            //$('.addproduct').click(function () {
            //    debugger
            //        var row = $(this).parents('tr');
            //        var data = [];
            //        var Obj =
            //        {

            //            Sku: $(row).find('.AddSku').val(),
            //            product_id: $(row).find('.product_id').val(),
            //            productstatus: $(row).find('.productstatus').val(),
            //            title: $(row).find(".AddTitle").val(),
            //            upc: $(row).find(".AddUpc").val(),
            //            colorid: $(row).find(".AddColor").val(),
            //        };
            //    data.push(Obj);
            //    console.log("get data", data)
            //});
            $('#DeleteProduct').click(function () {
                var productSku = $(this).attr('data-ProductSKU');

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("DeletProduct", "Product")?ProductSku='+productSku,
                    data: {},
                    success: function (data) {
                        console.log(data.statuss)
                    }
                });

            });



            $('input[id=SKU]').keyup(function (e) {
                $(this).val($(this).val().replace(/ +?/g, ''));
                $(this).addClass('text-uppercase');
                var remaining = 20 - $('#SKU').val().length;
                if (e.which == 32)
                    return false;

                $('#SKUCounter').text(remaining + "/" + 20);

                 var textBoxValue = $(this).val().trim();
            if (textBoxValue.length > 0) {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("CheckProductSKUExists", "Product")',
                    data: { 'name': textBoxValue },
                    success: function (data) {
                        if (data.success == true) {
                            $('#IsExistsSKU').text("Already Exists").css("color", "red");
                            $('#InputSubmit').attr("disabled", true)
                        }
                        else {
                            $('#IsExistsSKU').text("Available").css("color", "green");
                            $('#InputSubmit').attr("disabled", false)
                        }
                    }
                });
            }
            else {
                $('#IsExistsSKU').text("");
            }


            });


            // focus in if default value is 0 than make it empty
            $("#UPCID, #shipmentLenghtId ,#shipmentHeightId ,#shipmentWidthId, #ShipmentWeightId ,#AvgCostId").focus(function () {
                if ($(this).val() == "0.00") {
                    $(this).val("");
                }
            });

            // focus out if default value is empty than make it 0
            $("#UPCID, #shipmentLenghtId ,#shipmentHeightId ,#shipmentWidthId, #ShipmentWeightId ,#AvgCostId").focusout(function () {

                if ($(this).val() == "") {
                    $(this).val("0");
                }
            });




            $("#fUpload").on("change", function (e) {

                var files = e.target.files,
                    filesLength = files.length;
                for (var i = 0; i < filesLength; i++) {
                    var f = files[i]
                    var fileReader = new FileReader();
                    fileReader.onload = (function (e) {
                        var file = e.target;
                        $("<span class=\"pip\">" +
                            "<img class=\"imageThumb\" src=\"" + e.target.result + "\" title=\"" + file.name + "\"/>" +
                            "</span>").insertAfter("#files");
                        $(".remove").click(function () {
                            var index = $(this).parent().index();
                            $(this).parent(".pip").remove();
                        });


                    });
                    fileReader.readAsDataURL(f);
                }
            });



            //on key press if textbox containa alphabets then remove those characters
            $("#UPCID,#shipmentLenghtId ,#shipmentHeightId ,#shipmentWidthId, #ShipmentWeightId ,#AvgCostId,#lblAvgCostCanada").keyup(function (event) {

                    var $this = $(this);
                 $this.val($this.val().replace(/[^\d.]/g, ''));

              if (event.target.id == "AvgCostId") {
                    $('#lblAvgCostCanada').val(parseFloat($('#AvgCostId').val() * $('#currencyRate').val()).toFixed(2));
                    $('#lblAvgCostCanada').prop("readonly",true)
                }
                if (event.target.id == "lblAvgCostCanada") {
                    $('#AvgCostId').val(parseFloat($('#lblAvgCostCanada').val() / $('#currencyRate').val()).toFixed(2));
                    $('#AvgCostId').prop("readonly", true)
                }


            });

            $('#UPCID').keyup(function () {
                CountDownCharacter(12, 'UPCID', 'UPCCounter');
            });

            $('#productDescription').keyup(function () {
                CountDownCharacter(1000, 'productDescription', 'productDescriptionCounter');
            });

            $('input[id=ProductTitle]').keyup(function () {
                CountDownCharacter(200, 'ProductTitle', 'ProductTitleCounter');
            });

            // categories autoComplete

            $('#CategoryId').autocomplete({
                autoFocus: true,
                source: function (request, response) {
                    $.ajax({
                        url: "/Product/GetAllCategoriesForAutoComplete",
                        type: "POST",
                        minLength: 3,
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data, ui) {

                            //if (data.length > 0) {
                            response($.map(data, function (item) {
                                if (item != null) {
                                    return { label: item.Name, value: item.Name, id: item.ID };
                                }

                            }));
                        }
                    })
                },
                select: function (event, ui) {

                    $('#categoriesValueId').val(ui.item.id);
                },
                response: function (event, ui) {
                    if (ui.content.length === 0) {
                        $("#empty-message").text("No results found");
                        $('#categoriesValueId').val("0");
                        $('#InputSubmit').attr("disabled", true)
                    } else {
                        $("#empty-message").empty();
                        $('#InputSubmit').attr("disabled", false)
                    }
                }
            });


            debugger;
            $('.AddColor').autocomplete({
                autoFocus: true,
                source: function (request, response) {
                    $.ajax({
                        url: "/Product/GetAlColorForAutoComplete",
                        type: "POST",
                        minLength: 3,
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data, ui) {

                            //if (data.length > 0) {
                            response($.map(data, function (item) {
                                if (item != null) {
                                    return { label: item.Name, value: item.Name, ColorAlias: item.ColorAlias, id: item.ID };
                                }

                            }));
                        }
                    })
                },
                select: function (event, ui) {

                    $('#ColorIdForMessage').val(ui.item.id);
                    $('.ColorAlias').val(ui.item.ColorAlias);
                    $(this).parents('tr').find('.ColorId').val(ui.item.id);
                    //$('.ColorAlias').val(ui.);
                },
                response: function (event, ui) {
                    console.dir(ui.content)
                    if (ui.content.length === 0) {
                        $("#empty-message-Color").text("No results found");
                        $('#ColorIdForMessage').val("0");

                        $('#InputSubmit').attr("disabled", true)
                    } else {
                        $("#empty-message-Color").empty();
                        $('#InputSubmit').attr("disabled", false)
                    }
                }
            });


            // Brand AutoComplete

            $('#Brand').autocomplete({
                autoFocus: true,
                source: function (request, response) {
                    $.ajax({
                        url: "/Product/GetAllBrandForAutoComplete",
                        type: "POST",
                        minLength: 3,
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data, ui) {
                            response($.map(data, function (item) {
                                if (item != null) {

                                    return { label: item.BrandName, value: item.BrandName, id: item.BrandId };
                                }

                            }));
                        }
                    })
                },
                select: function (event, ui) {
                    debugger;
                    $('#BrandIdForMessage').val(ui.item.id);
                },
                response: function (event, ui) {

                    if (ui.content.length === 0) {
                        $("#empty-message-Brand").text("No results found");
                        $('#BrandIdForMessage').val("0");
                        $('#InputSubmit').attr("disabled", true)
                    } else {
                        $("#empty-message-Brand").empty();
                        $('#InputSubmit').attr("disabled", false)
                    }
                }
            });



            function CountDownCharacter(limit, controlID, target) {
                var remaining = limit - $('#' + controlID).val().length;
                $('#' + target).text(remaining + "/" + limit);
            }

            $('#ProductTitle').keyup(function () {
                capitalize_Words($(this).val(), 'ProductTitle');
            });



            function capitalize_Words(str, id) {
                var data = str.replace(/\w\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1) });
                $('#' + id).val(data);
            }

            $('#btnClose').click(function () {
                if ($('#HfProductId').length > 0) {
                    $.get('/Product/ShowImages/' + $('#HfProductId').val() + '').done(function (response) {
                        $('#imagesDivMainView').html(response);
                    });
                }
            });
        });


        function SubmitForm() {
            var files = $('#UloadImages').find('#fUpload').prop("files");
            var fdata = new FormData();
            for (var i = 0; i < files.length; i++) {
                fdata.append("files", files[i]);
            }
            fdata.append("ProductId", $('#HfProductId').val())
            if (files.length > 0) {
                $.ajax({
                    type: "POST",
                    url: "/Product/UploadImagesOfSku",
                    data: fdata ,
                    contentType: false,
                    processData: false,
                    success: function (response) {

                        $.get('/Product/ShowImages/' + $('#HfProductId').val()+'').done(function (response) {
                            $('#imagesDIV').html(response);
                        });
                    }
                });
            }
            else {
                alert('Please select a file.')
            }
        }


        function OpenUploadImagesForm(url) {
            $.get(url).done(function (response) {
                $('#modelBody').html(response);

                var res = url.split("/");

                $.get('/Product/ShowImages/'+res[3]+'').done(function (response) {
                    $('#imagesDIV').html(response);
                })
            });
        }

        $('body').on('click', 'span.close', function () {


            var ProductImageId = $(this).attr("data-porductImage-id");
            $(this).parent().remove();

            $.ajax({
                url: '@Url.Action("DeleteProductImage","Product")/' + ProductImageId + '',
                type: "POST",
                success: function (data) {
                    if (data.status) {

                        $(this).parent().remove();
                    }
                }
            });
        });



        $('body').on('keyup', '#UPCID', function () {
            var textBoxValue = $(this).val().trim();
            if (textBoxValue.length > 0) {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("CheckProductUPCExists", "Product")',
                    data: { 'name': textBoxValue },
                    success: function (data) {
                        if (data.success == true) {
                            $('#IsExistsUPC').text("Already Exists").css("color", "red");
                            $('#InputSubmit').attr("disabled", true)
                        }
                        else {
                            $('#IsExistsUPC').text("Available").css("color", "green");
                            $('#InputSubmit').attr("disabled", false)
                        }
                    }
                });
            }
            else {
                $('#IsExistsUPC').text("");
            }
        });


</script>
}
